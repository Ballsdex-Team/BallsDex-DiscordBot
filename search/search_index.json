{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Ballsdex - Discord bot","text":"<p>This documentation will contain both documentation and resources on how to use the Ballsdex Discord Bot, as well as resources for self-hosting it.</p> <p>Support our work on Patreon and get exclusive rewards!</p> <p>For $7.50/month, I will be hosting your custom bot on our server, with immediate updates, and a secure and shared admin panel!</p>"},{"location":"#support-us-on-patreon","title":"Support us on Patreon","text":""},{"location":"dev/custom-package/","title":"Writing custom packages","text":"<p>This tutorial will explain you how to extend Ballsdex with additional commands and features the recommended way.</p>"},{"location":"dev/custom-package/#getting-a-good-developer-environment","title":"Getting a good developer environment","text":"<p>Before getting to coding, you want to have a good environment to code and test quickly.</p> <ol> <li> <p>Download Visual Studio Code. Make sure to check the     \"Add to PATH\" option when prompted.</p> <p>If you're on Windows, install the WSL extension as well.</p> <p>Info</p> <p>You can use the editor of your choice, but Ballsdex is pre-configured for VScode and will give you the best out-of-the-box experience.</p> </li> <li> <p>Install and configure Ballsdex locally. I recommend that you follow the     Dockerless install to enable     VScode's Python debugger, but Docker is also fine.</p> <ol> <li>If you have followed the Docker installation, we will also configure a local environment     for autocompletion and editor experience.     First, install uv</li> <li>Open a terminal and <code>cd</code> into the Ballsdex folder</li> <li> <p>Run <code>uv sync --all-extras</code></p> <p>You may need to run this command from time to time if dependencies are updated.</p> </li> </ol> </li> <li> <p>Open a terminal, <code>cd</code> into the Ballsdex folder and run <code>code .</code> to open Visual Studio Code.     This also works inside WSL!</p> </li> <li> <p>Now you can run the bot in debug mode</p> With DockerWithout Docker <p>First, let's create a new file called <code>docker-compose.override.yml</code> to enable a few developer options:</p> <pre><code>services:\n  bot:\n    command: python3 -m ballsdex --dev --debug\n    environment:\n      - \"DJANGO_SETTINGS_MODULE=admin_panel.settings.dev\"\n  admin-panel:\n    environment:\n      - \"DJANGO_SETTINGS_MODULE=admin_panel.settings.dev\"\n</code></pre> <p>Then you can start the bot with the following command</p> <pre><code>docker compose down  # clear up old containers and load the new file\ndocker compose up --watch\n</code></pre> <p>The <code>--watch</code> option will enable live-reloading of your code inside Docker!</p> <pre><code>export DJANGO_SETTINGS_MODULE=admin_panel.settings.dev\n\n# run the bot like this\npython3 -m ballsdex --dev --debug\n\n# and the admin panel like this\nuvicorn --reload admin_panel.asgi:application\n</code></pre> <p>You can also use VScode's debugger by pressing F5, profiles are already registered!</p> </li> </ol> <p>That's it, you're now setup to develop on Ballsdex!</p>"},{"location":"dev/custom-package/#creating-your-package","title":"Creating your package","text":"<p>You will be writing a standalone pip-installable Python package. This means your code will live in its own repository, but for now we'll be coding in a special folder that makes development easier.</p> <ol> <li>Create a folder in <code>extra</code>, this will be your repository. For this example, let's call our     repository <code>my_cool_repo</code> <pre><code>mkdir extra/my_cool_repo\n</code></pre></li> <li> <p>Since you are writing a full Python package, you need a <code>pyproject.toml</code> file. Create the file     <code>extra/my_cool_repo/pyproject.toml</code> and place the following contents</p> <pre><code>[project]\nname = \"my_cool_repo\"\nversion = \"1.0.0\"\n\ndependencies = [\n    # you can require a specific version of ballsdex here\n    \"ballsdex&gt;=3.0.0\",\n]\n</code></pre> <p>You can customize this file later to include extra dependencies and more<sup>1</sup></p> </li> <li> <p>Now we need to create a Django application. I will name mine <code>my_cool_app</code></p> With DockerWithout Docker <pre><code>docker compose run --rm migration python3 -m django startapp my_cool_app /code/extra/my_cool_repo/my_cool_app\n</code></pre> <pre><code>export DJANGO_SETTINGS_MODULE=\"admin_panel.settings.dev\"\ncd extra/my_cool_repo\npython3 -m django startapp my_cool_app\n</code></pre> <p>This will create a new folder <code>my_cool_app</code> with the following files: -   <code>__init__.py</code>: mandatory, do not remove -   <code>admin.py</code>: useful if you want to extend the admin panel -   <code>apps.py</code>: mandatory, do not remove -   <code>models.py</code>: this is where you want to put your custom models if you need to save data -   <code>tests.py</code>: unused, can be removed -   <code>views.py</code>: unless you're writing web pages (why), can be removed</p> </li> </ol>"},{"location":"dev/custom-package/#adding-a-discordpy-extension","title":"Adding a discord.py extension","text":"<p>The reason why you're here is most likely to write custom discord.py extension. This will allow you to write your own commands and listeners.</p> <ol> <li> <p>Let's call our extension <code>my_cool_ext</code>. We will create the following files:</p> extra/my_cool_repo/my_cool_app/my_cool_ext/cog.py<pre><code>from typing import TYPE_CHECKING\n\nfrom discord import app_commands\nfrom discord.ext import commands\n\nif TYPE_CHECKING:\n    from ballsdex.core.bot import BallsDexBot\n\n\nclass YourCog(commands.Cog):\n    def __init__(self, bot: \"BallsDexBot\"):\n        self.bot = bot\n\n    @commands.command()\n    async def hello(self, ctx: commands.Context[\"BallsDexBot\"]):\n        await ctx.send(\"Hello World!\")\n</code></pre> extra/my_cool_repo/my_cool_app/my_cool_ext/__init__.py<pre><code>from typing import TYPE_CHECKING\n\nfrom .cog import YourCog\n\nif TYPE_CHECKING:\n    from ballsdex.core.bot import BallsDexBot\n\n\nasync def setup(bot: \"BallsDexBot\"):\n    await bot.add_cog(YourCog(bot))\n</code></pre> </li> <li> <p>You now need to let your app know that it supports a discord.py extension, and where it's     located. Open <code>extra/my_cool_repo/my_cool_app/apps.py</code> and add the following line:</p> <pre><code>from django.apps import AppConfig\n\n\nclass MyCoolAppConfig(AppConfig):\n    name = \"my_cool_app\"\n    dpy_package = \"my_cool_app.my_cool_ext\"\n</code></pre> </li> </ol> <p>That's it, your discord.py extension is now ready with a minimal command to test if it loaded properly!</p>"},{"location":"dev/custom-package/#loading-your-code","title":"Loading your code","text":"<p>For now we will only be looking at loading your code from a developer's perspective.</p> With DockerWithout Docker <ol> <li> <p>Create the file <code>config/extra.toml</code> and write the following contents</p> <pre><code>[[ballsdex.packages]]\nlocation = \"/code/extra/my_cool_repo\"\npath = \"my_cool_app\"\nenabled = true\neditable = true\n</code></pre> </li> <li> <p>Install your package with <code>docker compose build</code> (you should only need to do this once)</p> </li> <li>Launch the bot with <code>docker compose up --watch</code></li> </ol> <ol> <li> <p>Create the file <code>config/extra.toml</code> and write the following contents</p> <pre><code>[[ballsdex.packages]]\nlocation = \"\"  # this only matters for Docker\npath = \"my_cool_app\"\nenabled = true\neditable = true\n</code></pre> </li> <li> <p>Make sure your uv env is activated</p> </li> <li>Install your package with <code>uv pip install -e extra/my_cool_repo</code></li> <li>Launch the bot!</li> </ol> <p>You should notice this appearing in your bot's logs if successful: <pre><code>2025-12-16 14:32:17 INFO     ballsdex.core.bot Packages loaded: admin, balls, guildconfig, countryballs, info, players, trade, my_cool_ext\n</code></pre></p> <p>Test the <code>b.hello</code> command somewhere in Discord and see if the bot responds!</p> <p>Tip</p> <p>You can use <code>b.reload my_cool_ext</code> to live-reload new changes applied to your code without restarting the bot.</p> <p>Useful links</p> <ul> <li>discord.py Cogs</li> <li>discord.py commands</li> <li>discord.py interactions (app commands and buttons)</li> </ul>"},{"location":"dev/custom-package/#using-the-database","title":"Using the database","text":"<p>The point of having a Django app is to let you write your own models and use them in your application. Let's write a few example models.</p> <p>Let's suppose our app wants to add a profile command, which lets the player define a title, a bio, countries they're open for trade, and their best friend. We need two tables:</p> <ul> <li><code>Profile</code> which stores the title, bio and best friend</li> <li><code>LFBall</code> which stores which countries a player may be looking for</li> </ul> <p>A possible model definition would be the following:</p> models.py<pre><code>from django.db import models\n\nfrom bd_models.models import Ball, Player, Special\n\n\nclass Profile(models.Model):\n    # link the profile to exactly one player\n    # if the player is deleted, the profile will be deleted too\n    player = models.OneToOneField(Player, on_delete=models.CASCADE)\n\n    title = models.CharField(max_length=32)\n    bio = models.TextField()  # uncapped in length\n\n    # this field will be optional, if the other player is deleted, then the favorite is set back to null\n    # it's a ForeignKey (OneToMany) instead of a OneToOneField, since a player may be the favorite friend of multiples\n    favorite_friend = models.ForeignKey(Player, on_delete=models.SET_NULL, null=True)\n\n    class Meta:\n        constraints = [\n            # a simple restriction to ensure the player doesn't set themselves as favorite friend\n            models.CheckConstraint(condition=~models.Q(player=models.F(\"favorite_friend\")), name=\"friend_neq_player\")\n        ]\n\n\nclass LFBall(models.Model):\n    # this time we will be using a ForeignKey as one player may have multiple LFBall entries\n    player = models.ForeignKey(Player, on_delete=models.CASCADE)\n    # same for the ball the player is looking for\n    ball = models.ForeignKey(Ball, on_delete=models.CASCADE)\n\n    # we will also add an optional \"special\" specifier\n    # if a special gets deleted, the LF entry should also be removed\n    special = models.ForeignKey(Special, on_delete=models.CASCADE, null=True)\n</code></pre> <p>Once this code has been written, we have to write a migration, it's a generated file that will define how to populate the database the first time your app is loaded or updated.</p> With DockerWithout Docker <pre><code>docker compose run --rm migration python3 -m django makemigrations my_cool_app\n</code></pre> <pre><code>python3 -m django makemigrations my_cool_app\n</code></pre> <p>This should generate the following, along with a new file in <code>extra/my_cool_repo/my_cool_app/migrations/0001_initial.py</code> <pre><code>Migrations for 'test_app':\n  /code/extra/test_app/test_app/migrations/0001_initial.py\n    + Create model LFBall\n    + Create model Profile\n</code></pre></p> <p>Then you simply need to run migrations as usual (done automatically in Docker). If you need to edit your models in future versions, just generate more migrations (and don't delete the previous ones).</p> <p>It can then be used in your code like this:</p> <pre><code>...\n\nfrom bd_models.models import Player\n\nfrom ..models import Profile, LFBall\n\n\nclass YourCog(commands.Cog):\n    ...\n\n    @app_commands.command()\n    async def profile(self, interaction: discord.Interaction[\"BallsDexBot\"], user: discord.User | None = None):\n        user = user or interaction.user\n        try:\n            player = await Player.objects.aget(discord_id=user.id)\n            # pre-fetch the favorite friend's details\n            profile = await Profile.objects.aget(player=player).prefetch_related(\"favorite_friend\")\n        except Player.DoesNotExist:\n            await interaction.response.send_message(\"No such player.\", ephemeral=True)\n            return\n        except Profile.DoesNotExist:\n            await interaction.response.send_message(\"No profile associated.\", ephemeral=True)\n            return\n\n        text = (\n            f\"# {user.name}'s profile\\n\"\n            f\"-# {profile.title}\\n\"\n            f\"{profile.bio}\\n\"\n        )\n        if profile.favorite_friend:\n            text += f\"Favorite friend: &lt;@{profile.favorite_friend.discord_id}&gt;\\n\"\n\n        lf_query = LFBall.objects.filter(player=player)\n        if await lf_query.aexists():\n            text += f\"## Looking for\\n\"\n            async for ball in lf_query:\n                text += f\"- {ball.country}\\n\"\n\n        await interaction.response.send_message(text)\n</code></pre> <p>Please note that all Django queries must be using the asynchronous version, using synchronous version will crash.</p> <p>If you need to fetch the object behind a <code>ForeignKey</code>, don't forget to use <code>prefetch_related</code> or this will trigger an additional query, and fail because it's not asynchronous.</p> <p>Useful links</p> <ul> <li>Django ORM tutorial</li> <li>Django queries reference</li> </ul>"},{"location":"dev/custom-package/#using-the-admin-panel","title":"Using the admin panel","text":"<p>You can also make use of the admin panel through the <code>admin.py</code> file. The most basic configuration will look like this:</p> admin.py<pre><code>from django.contrib import admin\n\nfrom .models import LFBall, Profile\n\n\n@admin.register(Profile)\nclass ProfileAdmin(admin.ModelAdmin):\n    pass\n\n\n@admin.register(LFBall)\nclass LFBallAdmin(admin.ModelAdmin):\n    pass\n</code></pre> <p>Then loading the admin panel will display your app:  </p> <p>However, be careful with large models such as <code>Player</code> or <code>BallInstance</code>, they will load all items in the admin panel. You can avoid this with <code>autocomplete_fields</code>:</p> <pre><code>@admin.register(Profile)\nclass ProfileAdmin(admin.ModelAdmin):\n    autocomplete_fields = (\"player\", \"favorite_friend\")\n\n\n@admin.register(LFBall)\nclass LFBallAdmin(admin.ModelAdmin):\n    autocomplete_fields = (\"player\", \"ball\")\n</code></pre> <p>There are many more options, feel free to take a look at the documentation or how I wrote the admin views in <code>admin_panel/bd_models/admin/</code>.</p>"},{"location":"dev/custom-package/#publishing-your-package","title":"Publishing your package","text":"<p>Once your package is ready, you can choose to publish it!</p> <ol> <li> <p>Make a repository of your folder, and commit your changes</p> <pre><code>cd extra/my_cool_repo\ngit init\n</code></pre> </li> <li> <p>Create a <code>.gitignore</code> to avoid pushing unwanted files. A minimal one may contain:</p> <pre><code># Python stuff\n*.pyc\n__pycache__\n*.egg-info\n</code></pre> </li> <li> <p>For your project to be open source and allow others to use it, you need a license.</p> <p>Visit https://choosealicense.com/ and put the contents of your license in a file named <code>LICENSE</code> at the root of your repository (<code>extra/my_cool_repo/LICENSE</code>).</p> </li> <li> <p>Write a cool <code>README.md</code> describing your app.</p> </li> <li> <p>Review the contents of your <code>pyproject.toml</code> and add some metadata. Don't forget to put the     license.</p> <pre><code>[project]\nname = \"my_cool_repo\"\nversion = \"1.0.0\"\n\ndescription = \"A very nice repository\"\nlicense = \"MIT\"  # replace with your own license\nlicense-files = [\"LICENSE\"]\nauthors = [\n    { name = \"laggron42\", email = \"laggron42@ballsdex.com\" },\n]\nreadme = \"README.md\"\n\ndependencies = [\n    # you can require a specific version of ballsdex here\n    \"ballsdex&gt;=3.0.0\",\n    # and extra dependencies if needed\n]\n\n[project.urls]\n# put your own links here\n# https://packaging.python.org/en/latest/specifications/well-known-project-urls/#well-known-project-urls\nHomepage = \"https://github.com/username/repo-name\"\n</code></pre> <p>Check out the <code>pyproject.toml</code> documentation to read more about what you can put there.</p> <p>Info</p> <p>The <code>name</code>, <code>version</code>, <code>description</code>, <code>license-files</code>, <code>authors</code> and <code>project.urls</code> fields will be displayed to all users via the core <code>/about</code> command.</p> </li> <li> <p>Commit your code.</p> <pre><code>git add --all\n# review that only the files you want to push are listed\ngit status\n# and commit\ngit commit -m \"First commit\"\n</code></pre> <p>Warning</p> <p>You may need to configure your username and email if this is your first time using git.</p> </li> <li> <p>Create an online repository on the host of your choice (Github, Gitlab, ...) and push your     repo. I will assume that my repository's URL is <code>https://github.com/laggron42/my_cool_repo.git</code></p> <pre><code>git remote add origin https://github.com/laggron42/my_cool_repo.git\ngit push -u origin master\n</code></pre> </li> </ol> <p>All done, your project is now published!</p> <p>If you need to update your project in the future, don't forget to update the <code>version</code> in your <code>pyproject.toml</code>.</p>"},{"location":"dev/custom-package/#installing-your-package-as-a-user","title":"Installing your package as a user","text":"<p>Any user wishing to install your package must simply add the following contents in their <code>config/extra.toml</code> file:</p> <pre><code>[[ballsdex.packages]]\nlocation = \"git+https://github.com/laggron42/my_cool_repo.git==1.0.0\"\npath = \"my_cool_app\"\nenabled = true\n</code></pre> <p>It's important that <code>editable</code> is omitted or set to <code>false</code>, it will only work for the developer.</p> <ol> <li> <p>Python packaging \u21a9</p> </li> </ol>"},{"location":"dev/api/bot/","title":"Bot class","text":""},{"location":"dev/api/bot/#ballsdex.core.bot","title":"ballsdex.core.bot","text":""},{"location":"dev/api/bot/#ballsdex.core.bot.DEFAULT_PACKAGES","title":"DEFAULT_PACKAGES","text":"<pre><code>DEFAULT_PACKAGES = (('admin', 'ballsdex.packages.admin'), ('balls', 'ballsdex.packages.balls'), ('guildconfig', 'ballsdex.packages.guildconfig'), ('countryballs', 'ballsdex.packages.countryballs'), ('info', 'ballsdex.packages.info'), ('players', 'ballsdex.packages.players'), ('trade', 'ballsdex.packages.trade'))\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.http_counter","title":"http_counter","text":"<pre><code>http_counter = Histogram('discord_http_requests', 'HTTP requests', ['key', 'code'])\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.impersonations","title":"impersonations","text":"<pre><code>impersonations: dict[int, Member] = {}\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.log","title":"log","text":"<pre><code>log = getLogger('ballsdex.core.bot')\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot","title":"BallsDexBot","text":"<pre><code>BallsDexBot(command_prefix: PrefixType[BallsDexBot], disable_message_content: bool = False, disable_time_check: bool = False, skip_tree_sync: bool = False, gateway_url: str | None = None, dev: bool = False, **options)\n</code></pre> <p>               Bases: <code>AutoShardedBot</code></p> <p>BallsDex Discord bot</p> Source code in <code>ballsdex/core/bot.py</code> <pre><code>def __init__(\n    self,\n    command_prefix: PrefixType[BallsDexBot],\n    disable_message_content: bool = False,\n    disable_time_check: bool = False,\n    skip_tree_sync: bool = False,\n    gateway_url: str | None = None,\n    dev: bool = False,\n    **options,\n):\n    # An explaination for the used intents\n    # guilds: needed for basically anything, the bot needs to know what guilds it has\n    # and accordingly enable automatic spawning in the enabled ones\n    # guild_messages: spawning is based on messages sent, content is not necessary\n    # emojis_and_stickers: DB holds emoji IDs for the balls which are fetched from 3 servers\n    intents = discord.Intents(\n        guilds=True, guild_messages=True, emojis_and_stickers=True, message_content=not disable_message_content\n    )\n    if disable_message_content:\n        log.warning(\"Message content disabled, this will make spam detection harder\")\n\n    if settings.prometheus_enabled:\n        trace = aiohttp.TraceConfig()\n        trace.on_request_start.append(on_request_start)\n        trace.on_request_end.append(on_request_end)\n        options[\"http_trace\"] = trace\n\n    super().__init__(\n        command_prefix, intents=intents, tree_cls=CommandTree, help_command=HelpCommand(width=100), **options\n    )\n    self.tree: CommandTree[Self]\n    self.tree.disable_time_check = disable_time_check\n    self.skip_tree_sync = skip_tree_sync\n    self.gateway_url = gateway_url\n\n    self.dev = dev\n    self.prometheus_server: PrometheusServer | None = None\n\n    self.tree.error(self.on_application_command_error)\n\n    self._shutdown = 0\n    self.startup_time: datetime | None = None\n    self.application_emojis: dict[int, discord.Emoji] = {}\n    self.blacklist: set[int] = set()\n    self.blacklist_guild: set[int] = set()\n    self.catch_log: set[int] = set()\n    self.command_log: set[int] = set()\n    self.locked_balls = TTLCache(maxsize=99999, ttl=60 * 30)\n\n    self.owner_ids: set[int]\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.application_emojis","title":"application_emojis","text":"<pre><code>application_emojis: dict[int, Emoji] = {}\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.blacklist","title":"blacklist","text":"<pre><code>blacklist: set[int] = set()\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.blacklist_guild","title":"blacklist_guild","text":"<pre><code>blacklist_guild: set[int] = set()\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.catch_log","title":"catch_log","text":"<pre><code>catch_log: set[int] = set()\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.command_log","title":"command_log","text":"<pre><code>command_log: set[int] = set()\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.dev","title":"dev","text":"<pre><code>dev = dev\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.gateway_url","title":"gateway_url","text":"<pre><code>gateway_url = gateway_url\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.locked_balls","title":"locked_balls","text":"<pre><code>locked_balls = TTLCache(maxsize=99999, ttl=60 * 30)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.owner_ids","title":"owner_ids","text":"<pre><code>owner_ids: set[int]\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.prometheus_server","title":"prometheus_server","text":"<pre><code>prometheus_server: PrometheusServer | None = None\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.skip_tree_sync","title":"skip_tree_sync","text":"<pre><code>skip_tree_sync = skip_tree_sync\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.startup_time","title":"startup_time","text":"<pre><code>startup_time: datetime | None = None\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.tree","title":"tree","text":"<pre><code>tree: CommandTree[Self]\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.add_cog","title":"add_cog","text":"<pre><code>add_cog(cog: Cog, /, *, override: bool = False, guild: Snowflake | None = MISSING, guilds: Sequence[Snowflake] = MISSING) -&gt; None\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def add_cog(\n    self,\n    cog: commands.Cog,\n    /,\n    *,\n    override: bool = False,\n    guild: discord.abc.Snowflake | None = MISSING,\n    guilds: Sequence[discord.abc.Snowflake] = MISSING,\n) -&gt; None:\n    # hook that will check before loading a cog that Django permission checks are valid\n    await check_perms()\n    await super().add_cog(cog, override=override, guild=guild, guilds=guilds)\n    if self.is_ready():\n        await self.tree.load_command_mentions(cog=cog)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.blacklist_check","title":"blacklist_check","text":"<pre><code>blacklist_check(source: Interaction[Self] | Context[Self]) -&gt; bool\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def blacklist_check(self, source: discord.Interaction[Self] | commands.Context[Self]) -&gt; bool:\n    if isinstance(source, discord.Interaction):\n        user = source.user\n        guild_id = source.guild_id\n        if source.type != discord.InteractionType.autocomplete:\n            send_func = source.response.send_message\n        else:\n            # empty awaitable function\n            send_func = lambda *ar, **kw: asyncio.sleep(0)  # noqa: E731\n    else:\n        user = source.author\n        guild_id = source.guild.id if source.guild else None\n        send_func = source.send\n    if user.id in self.blacklist:\n        await send_func(\n            \"You are blacklisted from the bot.\\nYou can appeal this blacklist in our support server: {}\".format(\n                settings.discord_invite\n            ),\n            ephemeral=True,\n        )\n        return False\n    if guild_id and guild_id in self.blacklist_guild:\n        await send_func(\n            \"This server is blacklisted from the bot.\"\n            \"\\nYou can appeal this blacklist in our support server: {}\".format(settings.discord_invite),\n            ephemeral=True,\n        )\n        return False\n    if source.command and user.id in self.command_log:\n        log.info(f'{user} ({user.id}) used \"{source.command.qualified_name}\" in {source.guild} ({guild_id})')\n    return True\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.gateway_healthy","title":"gateway_healthy","text":"<pre><code>gateway_healthy() -&gt; bool\n</code></pre> <p>Check whether or not the gateway proxy is ready and healthy.</p> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def gateway_healthy(self) -&gt; bool:\n    \"\"\"Check whether or not the gateway proxy is ready and healthy.\"\"\"\n    if self.gateway_url is None:\n        raise RuntimeError(\"This is only available on the production bot instance.\")\n\n    try:\n        base_url = str(discord.gateway.DiscordWebSocket.DEFAULT_GATEWAY).replace(\"ws://\", \"http://\")\n        async with aiohttp.ClientSession() as session:\n            async with session.get(f\"{base_url}/health\", timeout=ClientTimeout(total=10)) as resp:\n                return resp.status == 200\n    except (aiohttp.ClientConnectionError, asyncio.TimeoutError):\n        return False\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.get_emoji","title":"get_emoji","text":"<pre><code>get_emoji(id: int) -&gt; Emoji | None\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>def get_emoji(self, id: int) -&gt; discord.Emoji | None:\n    return self.application_emojis.get(id) or super().get_emoji(id)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.load_cache","title":"load_cache","text":"<pre><code>load_cache()\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def load_cache(self):\n    table = Table(box=box.SIMPLE)\n    table.add_column(\"Model\", style=\"cyan\")\n    table.add_column(\"Count\", justify=\"right\", style=\"green\")\n\n    self.application_emojis.clear()\n    for emoji in await self.fetch_application_emojis():\n        self.application_emojis[emoji.id] = emoji\n\n    balls.clear()\n    async for ball in Ball.objects.all():\n        balls[ball.pk] = ball\n    table.add_row(settings.collectible_name.title() + \"s\", str(len(balls)))\n\n    regimes.clear()\n    async for regime in Regime.objects.all():\n        regimes[regime.pk] = regime\n    table.add_row(\"Regimes\", str(len(regimes)))\n\n    economies.clear()\n    async for economy in Economy.objects.all():\n        economies[economy.pk] = economy\n    table.add_row(\"Economies\", str(len(economies)))\n\n    specials.clear()\n    async for special in Special.objects.all():\n        specials[special.pk] = special\n    table.add_row(\"Special events\", str(len(specials)))\n\n    self.blacklist = set()\n    async for blacklisted_id in BlacklistedID.objects.all().only(\"discord_id\"):\n        self.blacklist.add(blacklisted_id.discord_id)\n    table.add_row(\"Blacklisted users\", str(len(self.blacklist)))\n\n    self.blacklist_guild = set()\n    async for blacklisted_id in BlacklistedGuild.objects.all().only(\"discord_id\"):\n        self.blacklist_guild.add(blacklisted_id.discord_id)\n    table.add_row(\"Blacklisted guilds\", str(len(self.blacklist_guild)))\n\n    log.info(\"Cache loaded, summary displayed below:\")\n    console = Console()\n    console.print(table)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.on_application_command_error","title":"on_application_command_error","text":"<pre><code>on_application_command_error(interaction: Interaction[Self], error: AppCommandError)\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def on_application_command_error(\n    self, interaction: discord.Interaction[Self], error: app_commands.AppCommandError\n):\n    if isinstance(error, (app_commands.CommandNotFound, app_commands.CommandSignatureMismatch)):\n        if not self.is_ready():\n            log.warning(\"Command not found, but the bot hasn't started yet.\")\n            return\n        if interaction.type == discord.InteractionType.autocomplete:\n            return\n        send = interaction.followup.send if interaction.response.is_done() else interaction.response.send_message\n        try:\n            await send(\"Commands desynchronized, contact support to fix this.\")\n        except discord.NotFound:\n            pass\n        log.error(error.args[0])\n        return\n\n    await self.on_command_error(await commands.Context.from_interaction(interaction), error)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.on_command_error","title":"on_command_error","text":"<pre><code>on_command_error(context: Context, exception: CommandError | AppCommandError)\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def on_command_error(\n    self, context: commands.Context, exception: commands.errors.CommandError | app_commands.AppCommandError\n):\n    if isinstance(exception, (commands.CommandNotFound, commands.DisabledCommand)):\n        return\n\n    assert context.command\n    match exception:\n        case commands.BadArgument():\n            await context.send(exception.args[0])\n\n        case commands.ConversionError() | commands.UserInputError():\n            # in case we need to know what happened\n            log.debug(\"Silenced command exception\", exc_info=exception)\n            await context.send_help(context.command)\n\n        case commands.MissingRequiredAttachment():\n            await context.send(\"An attachment is missing.\", ephemeral=True)\n\n        case app_commands.CommandOnCooldown() | commands.CommandOnCooldown():\n            await context.send(\n                \"This command is on cooldown. Please retry \"\n                f\"&lt;t:{math.ceil(time.time() + exception.retry_after)}:R&gt;.\",\n                ephemeral=True,\n            )\n\n        case app_commands.TransformerError():\n            await context.send(\"One of the arguments provided cannot be parsed.\", ephemeral=True)\n            log.debug(\"Failed running converter\", exc_info=exception)\n\n        case commands.CheckFailure() | app_commands.CheckFailure():\n            match exception:\n                case commands.BotMissingPermissions() | app_commands.BotMissingPermissions():\n                    missing_perms = \", \".join(exception.missing_permissions)\n                    await context.send(\n                        f\"The bot is missing the permissions: `{missing_perms}`.\"\n                        \" Give the bot those permissions for the command to work as expected.\",\n                        ephemeral=True,\n                    )\n\n                case commands.MissingPermissions() | app_commands.MissingPermissions():\n                    missing_perms = \", \".join(exception.missing_permissions)\n                    await context.send(\n                        f\"You are missing the following permissions: `{missing_perms}`.\"\n                        \" You need those permissions to run this command.\",\n                        ephemeral=True,\n                    )\n\n                case _:\n                    await context.send(\"You are not allowed to use this command.\", ephemeral=True)\n\n        case app_commands.CommandInvokeError() | commands.CommandInvokeError():\n            match exception.original:\n                case discord.Forbidden():\n                    await context.send(\"The bot does not have the permission to do something.\", ephemeral=True)\n                    # log to know where permissions are lacking\n                    log.warning(\n                        f\"Missing permissions for command {context.command.qualified_name}\",\n                        exc_info=exception.original,\n                    )\n\n                case discord.InteractionResponded():\n                    # most likely an interaction received twice (happens sometimes),\n                    # or two instances are running on the same token.\n                    log.warning(\n                        f\"Tried invoking command {context.command.qualified_name}, but the \"\n                        \"interaction was already responded to.\",\n                        exc_info=exception.original,\n                    )\n\n                case discord.NotFound(code=10062) | discord.NotFound(code=10015):\n                    log.warning(\"Expired interaction\", exc_info=exception.original)\n\n                case _:\n                    # still including traceback because it may be a programming error\n                    await context.send(\n                        \"An error occured when running the command. Contact support if this persists.\",\n                        ephemeral=True,\n                    )\n                    log.error(\n                        f\"Unknown error in {'slash' if context.interaction else 'text'} command \"\n                        f\"{context.command.qualified_name}\",\n                        exc_info=exception.original,\n                    )\n\n        case _:\n            await context.send(\"An unknown error occured, contact support if this persists.\")\n            log.error(\"Unknown exception\", exc_info=exception)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.on_error","title":"on_error","text":"<pre><code>on_error(event_method: str, /, *args, **kwargs)\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def on_error(self, event_method: str, /, *args, **kwargs):\n    formatted_args = \", \".join((repr(x) for x in args))\n    formatted_kwargs = \" \".join(f\"{x}={y:r}\" for x, y in kwargs.items())\n    log.error(f\"Error in event {event_method}. Args: {formatted_args}. Kwargs: {formatted_kwargs}\", exc_info=True)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.on_ready","title":"on_ready","text":"<pre><code>on_ready()\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def on_ready(self):\n    if self.cogs != {}:\n        return  # bot is reconnecting, no need to setup again\n\n    if self.startup_time is None:\n        self.startup_time = datetime.now()\n\n    assert self.user\n    log.info(f\"Successfully logged in as {self.user} ({self.user.id})!\")\n\n    # set bot owners\n    assert self.application\n    if self.application.team:\n        if settings.team_owners:\n            self.owner_ids.update(m.id for m in self.application.team.members)\n        else:\n            self.owner_ids.add(self.application.team.owner_id)  # type: ignore\n    else:\n        self.owner_ids.add(self.application.owner.id)\n    if settings.co_owners:\n        self.owner_ids.update(settings.co_owners)\n    if len(self.owner_ids) &gt; 1:\n        log.info(f\"{len(self.owner_ids)} users are set as bot owner.\")\n    else:\n        log.info(f\"{await self.fetch_user(next(iter(self.owner_ids)))} is the owner of this bot.\")\n\n    await self.load_cache()\n    grammar = \"\" if len(self.blacklist) == 1 else \"s\"\n    if self.blacklist:\n        log.info(f\"{len(self.blacklist)} blacklisted user{grammar}.\")\n\n    log.info(\"Loading packages...\")\n    await self.add_cog(Core(self))\n    if self.dev:\n        await self.add_cog(Dev())\n\n    loaded_packages = []\n    packages = list(DEFAULT_PACKAGES)\n    for app in apps.get_app_configs():\n        if dpy_package := getattr(app, \"dpy_package\", None):\n            packages.append((app.label, dpy_package))\n\n    for package_name, path in packages:\n        try:\n            await self.load_extension(path)\n        except Exception:\n            log.error(f\"Failed to load package {package_name}\", exc_info=True)\n        else:\n            loaded_packages.append(package_name)\n    if loaded_packages:\n        log.info(f\"Packages loaded: {', '.join(loaded_packages)}\")\n    else:\n        log.info(\"No package loaded.\")\n\n    if not self.skip_tree_sync:\n        log.info(\"Syncing global commands...\")\n        synced_commands = await self.tree.sync()\n        log.info(f\"Synced {len(synced_commands)} global commands.\")\n    else:\n        log.warning(\"Skipping command synchronization.\")\n\n    if settings.prometheus_enabled:\n        try:\n            await self.start_prometheus_server()\n        except Exception:\n            log.exception(\"Failed to start Prometheus server, stats will be unavailable.\")\n\n    print(f\"\\n    [bold][red]{settings.bot_name} bot[/red] [green]is now operational![/green][/bold]\\n\")\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.setup_hook","title":"setup_hook","text":"<pre><code>setup_hook() -&gt; None\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def setup_hook(self) -&gt; None:\n    await self.tree.set_translator(Translator())\n    log.info(\"Starting up with %s shards...\", self.shard_count)\n    if self.gateway_url is None:\n        return\n\n    while True:\n        response = await self.gateway_healthy()\n        if response is True:\n            log.info(\"Gateway proxy is ready!\")\n            break\n\n        log.warning(\"Gateway proxy is not ready yet, waiting 30 more seconds...\")\n        await asyncio.sleep(30)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.BallsDexBot.start_prometheus_server","title":"start_prometheus_server","text":"<pre><code>start_prometheus_server()\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def start_prometheus_server(self):\n    self.prometheus_server = PrometheusServer(self, settings.prometheus_host, settings.prometheus_port)\n    await self.prometheus_server.run()\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.CommandTree","title":"CommandTree","text":"<p>               Bases: <code>CommandTree[Bot]</code></p>"},{"location":"dev/api/bot/#ballsdex.core.bot.CommandTree.disable_time_check","title":"disable_time_check","text":"<pre><code>disable_time_check: bool = False\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.CommandTree.interaction_check","title":"interaction_check","text":"<pre><code>interaction_check(interaction: Interaction[Bot]) -&gt; bool\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def interaction_check(self, interaction: discord.Interaction[Bot], /) -&gt; bool:\n    # checking if the moment we receive this interaction isn't too late already\n    # there is a 3 seconds limit for initial response, taking a little margin into account\n    # https://discord.com/developers/docs/interactions/receiving-and-responding#responding-to-an-interaction\n    if not self.disable_time_check:\n        delta = datetime.now(tz=interaction.created_at.tzinfo) - interaction.created_at\n        if delta.total_seconds() &gt;= 2.8:\n            log.warning(f\"Skipping interaction {interaction.id}, running {delta.total_seconds()}s late.\")\n            return False\n\n    bot = interaction.client\n    if not bot.is_ready():\n        if interaction.type != discord.InteractionType.autocomplete:\n            try:\n                await interaction.response.send_message(\n                    \"The bot is currently starting, please wait for a few minutes... \"\n                    f\"({round((len(bot.shards) / bot.shard_count) * 100)}%)\",\n                    ephemeral=True,\n                )\n            except discord.NotFound:\n                pass\n        return False  # wait for all shards to be connected\n\n    if impersonated := impersonations.get(interaction.user.id, None):\n        interaction.user = impersonated\n        interaction._permissions = impersonated._permissions or 0\n    return await bot.blacklist_check(interaction)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.CommandTree.load_command_mentions","title":"load_command_mentions","text":"<pre><code>load_command_mentions(app_commands: list[AppCommand] | None = None, *, cog: Cog | None = None)\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def load_command_mentions(\n    self, app_commands: list[app_commands.AppCommand] | None = None, *, cog: commands.Cog | None = None\n):\n    if app_commands is None:\n        cmds = {x.name: x.id for x in await self.fetch_commands()}\n    else:\n        cmds = {x.name: x.id for x in app_commands}\n\n    for cmd in (cog or self).walk_commands():\n        cmd_id = cmds.get(cmd.root_parent.name if cmd.root_parent else cmd.name, None)\n        if not cmd_id:\n            continue\n        cmd.extras[\"mention\"] = f\"&lt;/{cmd.qualified_name}:{cmd_id}&gt;\"\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.CommandTree.sync","title":"sync","text":"<pre><code>sync(*, guild: Snowflake | None = None) -&gt; list[AppCommand]\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def sync(self, *, guild: discord.abc.Snowflake | None = None) -&gt; list[app_commands.AppCommand]:\n    app_commands = await super().sync(guild=guild)\n    if not guild:\n        # assign the mentions\n        await self.load_command_mentions(app_commands)\n        return app_commands\n\n    return app_commands\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.Translator","title":"Translator","text":"<p>               Bases: <code>Translator</code></p>"},{"location":"dev/api/bot/#ballsdex.core.bot.Translator.translate","title":"translate","text":"<pre><code>translate(string: locale_str, locale: Locale, context: TranslationContextTypes) -&gt; str | None\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def translate(self, string: locale_str, locale: Locale, context: TranslationContextTypes) -&gt; str | None:\n    text = (\n        string.message.replace(\"countryballs\", settings.plural_collectible_name)\n        .replace(\"countryball\", settings.collectible_name)\n        .replace(\"/balls\", f\"/{settings.balls_slash_name}\")\n        .replace(\"BallsDex\", settings.bot_name)\n    )\n    if context.location in (TranslationContextLocation.command_name, TranslationContextLocation.group_name):\n        text = text.replace(\" \", \"-\").lower()\n\n    return text\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.on_request_end","title":"on_request_end","text":"<pre><code>on_request_end(session: ClientSession, trace_ctx: SimpleNamespace, params: TraceRequestEndParams)\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def on_request_end(\n    session: aiohttp.ClientSession, trace_ctx: types.SimpleNamespace, params: aiohttp.TraceRequestEndParams\n):\n    time = session.loop.time() - trace_ctx.start\n\n    # to categorize HTTP calls per path, we need to access the corresponding discord.http.Route\n    # object, which is not available in the context of an aiohttp TraceConfig, therefore it's\n    # obtained by accessing the locals() from the calling function HTTPConfig.request\n    # \"params.url.path\" is not usable as it contains raw IDs and tokens, breaking categories\n    frame = inspect.currentframe()\n    _locals = frame.f_back.f_back.f_back.f_back.f_back.f_locals  # type: ignore\n    if route := _locals.get(\"route\"):\n        route_key = route.key\n    else:\n        # calling function is HTTPConfig.static_login which has no Route object\n        route_key = f\"{params.response.method} {params.url.path}\"\n\n    http_counter.labels(route_key, params.response.status).observe(time)\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.on_request_start","title":"on_request_start","text":"<pre><code>on_request_start(session: ClientSession, trace_ctx: SimpleNamespace, params: TraceRequestStartParams)\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>async def on_request_start(\n    session: aiohttp.ClientSession, trace_ctx: types.SimpleNamespace, params: aiohttp.TraceRequestStartParams\n):\n    # register t1 before sending request\n    trace_ctx.start = session.loop.time()\n</code></pre>"},{"location":"dev/api/bot/#ballsdex.core.bot.owner_check","title":"owner_check","text":"<pre><code>owner_check(ctx: Context[BallsDexBot])\n</code></pre> Source code in <code>ballsdex/core/bot.py</code> <pre><code>def owner_check(ctx: commands.Context[BallsDexBot]):\n    return ctx.bot.is_owner(ctx.author)\n</code></pre>"},{"location":"dev/api/models/","title":"Models","text":""},{"location":"dev/api/models/#bd_models.models","title":"bd_models.models","text":""},{"location":"dev/api/models/#bd_models.models.balls","title":"balls","text":"<pre><code>balls: dict[int, Ball] = {}\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.economies","title":"economies","text":"<pre><code>economies: dict[int, Economy] = {}\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.regimes","title":"regimes","text":"<pre><code>regimes: dict[int, Regime] = {}\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.specials","title":"specials","text":"<pre><code>specials: dict[int, Special] = {}\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball","title":"Ball","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Ball.attack","title":"attack","text":"<pre><code>attack = IntegerField(help_text='Ball attack stat')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.cached_economy","title":"cached_economy","text":"<pre><code>cached_economy: Economy | None\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.cached_regime","title":"cached_regime","text":"<pre><code>cached_regime: Regime\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.capacity_description","title":"capacity_description","text":"<pre><code>capacity_description = CharField(max_length=256, help_text=\"Description of the countryball's capacity\")\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.capacity_logic","title":"capacity_logic","text":"<pre><code>capacity_logic = JSONField(help_text='Effect of this capacity', blank=True, default=dict)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.capacity_name","title":"capacity_name","text":"<pre><code>capacity_name = CharField(max_length=64, help_text=\"Name of the countryball's capacity\")\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.catch_names","title":"catch_names","text":"<pre><code>catch_names = TextField(blank=True, null=True, help_text='Additional possible names for catching this ball, separated by semicolons')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.collection_card","title":"collection_card","text":"<pre><code>collection_card = ImageField(max_length=200, help_text='Image used when displaying balls')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.country","title":"country","text":"<pre><code>country = CharField(unique=True, max_length=48, verbose_name='Name')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.created_at","title":"created_at","text":"<pre><code>created_at = DateTimeField(blank=True, null=True, auto_now_add=True, editable=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.credits","title":"credits","text":"<pre><code>credits = CharField(max_length=64, help_text='Author of the collection artwork')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.economy","title":"economy","text":"<pre><code>economy = ForeignKey(Economy, on_delete=SET_NULL, blank=True, null=True, help_text='Economical regime of this country')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.economy_id","title":"economy_id","text":"<pre><code>economy_id: int | None\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.emoji_id","title":"emoji_id","text":"<pre><code>emoji_id = BigIntegerField(help_text='Emoji ID for this ball')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.enabled","title":"enabled","text":"<pre><code>enabled = BooleanField(help_text='Enables spawning and show in completion', default=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.enabled_objects","title":"enabled_objects","text":"<pre><code>enabled_objects: EnabledManager[Self] = EnabledManager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.health","title":"health","text":"<pre><code>health = IntegerField(help_text='Ball health stat')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.rarity","title":"rarity","text":"<pre><code>rarity = FloatField(help_text='Rarity of this ball')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.regime","title":"regime","text":"<pre><code>regime = ForeignKey(Regime, on_delete=CASCADE, help_text='Political regime of this country')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.regime_id","title":"regime_id","text":"<pre><code>regime_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.short_name","title":"short_name","text":"<pre><code>short_name = CharField(max_length=24, blank=True, null=True, help_text='An alternative shorter name used only when generating the card, if the base name is too long.')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.tradeable","title":"tradeable","text":"<pre><code>tradeable = BooleanField(help_text='Whether this ball can be traded with others', default=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.tradeable_objects","title":"tradeable_objects","text":"<pre><code>tradeable_objects: TradeableManager[Self] = TradeableManager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.translations","title":"translations","text":"<pre><code>translations = TextField(blank=True, null=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.wild_card","title":"wild_card","text":"<pre><code>wild_card = ImageField(max_length=200, help_text='Image used when a new ball spawns in the wild')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Ball.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'ball'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return self.country\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.collection_image","title":"collection_image","text":"<pre><code>collection_image() -&gt; SafeText\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>@admin.display(description=\"Current collection card\")\ndef collection_image(self) -&gt; SafeText:\n    return image_display(str(self.collection_card))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.save","title":"save","text":"<pre><code>save(**kwargs) -&gt; None\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def save(self, **kwargs) -&gt; None:\n    def lower_catch_names(names: str | None) -&gt; str | None:\n        if names:\n            return \";\".join([x.strip() for x in names.split(\";\")]).lower()\n\n    self.catch_names = lower_catch_names(self.catch_names)\n    self.translations = lower_catch_names(self.translations)\n\n    return super().save(**kwargs)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Ball.spawn_image","title":"spawn_image","text":"<pre><code>spawn_image() -&gt; SafeText\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>@admin.display(description=\"Current spawn asset\")\ndef spawn_image(self) -&gt; SafeText:\n    return image_display(str(self.wild_card))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance","title":"BallInstance","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.BallInstance.all_objects","title":"all_objects","text":"<pre><code>all_objects: BaseBallInstanceManager[Self] = BaseBallInstanceManager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.attack","title":"attack","text":"<pre><code>attack: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.attack_bonus","title":"attack_bonus","text":"<pre><code>attack_bonus = IntegerField(default=0)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.ball","title":"ball","text":"<pre><code>ball = ForeignKey(Ball, on_delete=CASCADE)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.ball_id","title":"ball_id","text":"<pre><code>ball_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.catch_date","title":"catch_date","text":"<pre><code>catch_date = DateTimeField(auto_now_add=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.countryball","title":"countryball","text":"<pre><code>countryball: Ball\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.deleted","title":"deleted","text":"<pre><code>deleted = BooleanField(default=False, help_text='Whether this instance was deleted or not.')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.extra_data","title":"extra_data","text":"<pre><code>extra_data = JSONField(blank=True, default=dict)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.favorite","title":"favorite","text":"<pre><code>favorite = BooleanField(default=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.health","title":"health","text":"<pre><code>health: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.health_bonus","title":"health_bonus","text":"<pre><code>health_bonus = IntegerField(default=0)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.is_tradeable","title":"is_tradeable","text":"<pre><code>is_tradeable: bool\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.locked","title":"locked","text":"<pre><code>locked = DateTimeField(blank=True, null=True, help_text='If the instance was locked for a trade and when', default=None)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.objects","title":"objects","text":"<pre><code>objects: BallInstanceManager[Self] = BallInstanceManager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.player","title":"player","text":"<pre><code>player = ForeignKey(Player, on_delete=CASCADE, related_name='balls')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.player_id","title":"player_id","text":"<pre><code>player_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.server_id","title":"server_id","text":"<pre><code>server_id = BigIntegerField(blank=True, null=True, help_text='Discord server ID where this ball was caught')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.spawned_time","title":"spawned_time","text":"<pre><code>spawned_time = DateTimeField(blank=True, null=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.special","title":"special","text":"<pre><code>special = ForeignKey(Special, on_delete=SET_NULL, null=True, blank=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.special_card","title":"special_card","text":"<pre><code>special_card: 'ImageFieldFile | None'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.special_id","title":"special_id","text":"<pre><code>special_id: int | None\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.specialcard","title":"specialcard","text":"<pre><code>specialcard: Special | None\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.trade_player","title":"trade_player","text":"<pre><code>trade_player = ForeignKey(Player, on_delete=SET_NULL, related_name='ballinstance_trade_player_set', null=True, blank=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.trade_player_id","title":"trade_player_id","text":"<pre><code>trade_player_id: int | None\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.tradeable","title":"tradeable","text":"<pre><code>tradeable = BooleanField(default=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.tradeable_objects","title":"tradeable_objects","text":"<pre><code>tradeable_objects: TradeableManager[Self] = TradeableManager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.BallInstance.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'ballinstance'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.Meta.indexes","title":"indexes","text":"<pre><code>indexes = (Index(fields=('ball_id',)), Index(fields=('player_id',)), Index(fields=('special_id',)), Index(fields=('deleted',)))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.Meta.unique_together","title":"unique_together","text":"<pre><code>unique_together = (('player', 'id'),)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return self.short_description()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.admin_description","title":"admin_description","text":"<pre><code>admin_description() -&gt; SafeText\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>@admin.display(description=\"Countryball\")\ndef admin_description(self) -&gt; SafeText:\n    text = str(self)\n    emoji = f'&lt;img src=\"https://cdn.discordapp.com/emojis/{self.ball.emoji_id}.png?size=20\" /&gt;'\n    return mark_safe(f\"{emoji} {text} ATK:{self.attack_bonus:+d}% HP:{self.health_bonus:+d}%\")\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.catch_time","title":"catch_time","text":"<pre><code>catch_time()\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>@admin.display(description=\"Time to catch\")\ndef catch_time(self):\n    if self.spawned_time:\n        return str(self.catch_date - self.spawned_time)\n    return \"-\"\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.description","title":"description","text":"<pre><code>description(*, short: bool = False, include_emoji: bool = False, bot: 'BallsDexBot | None' = None, is_trade: bool = False) -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def description(\n    self,\n    *,\n    short: bool = False,\n    include_emoji: bool = False,\n    bot: \"BallsDexBot | None\" = None,\n    is_trade: bool = False,\n) -&gt; str:\n    text = self.short_description(is_trade=is_trade)\n    if not short:\n        text += f\" ATK:{self.attack_bonus:+d}% HP:{self.health_bonus:+d}%\"\n    if include_emoji:\n        if not bot:\n            raise TypeError(\"You need to provide the bot argument when using with include_emoji=True\")\n        if isinstance(self.countryball, Ball):\n            emoji = bot.get_emoji(self.countryball.emoji_id)\n            if emoji:\n                text = f\"{emoji} {text}\"\n    return text\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.draw_card","title":"draw_card","text":"<pre><code>draw_card() -&gt; BytesIO\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def draw_card(self) -&gt; BytesIO:\n    image, kwargs = draw_card(self)\n    buffer = BytesIO()\n    image.save(buffer, **kwargs)\n    buffer.seek(0)\n    image.close()\n    return buffer\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.is_locked","title":"is_locked","text":"<pre><code>is_locked(refresh: bool = True)\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def is_locked(self, refresh: bool = True):\n    if refresh:\n        await self.arefresh_from_db(fields=[\"locked\"])\n    self.locked\n    return self.locked is not None and (self.locked + timedelta(minutes=30)) &gt; timezone.now()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.lock_for_trade","title":"lock_for_trade","text":"<pre><code>lock_for_trade()\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def lock_for_trade(self):\n    self.locked = timezone.now()\n    await self.asave(update_fields=(\"locked\",))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.prepare_for_message","title":"prepare_for_message","text":"<pre><code>prepare_for_message(interaction: Interaction['BallsDexBot']) -&gt; tuple[str, File, View]\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def prepare_for_message(\n    self, interaction: discord.Interaction[\"BallsDexBot\"]\n) -&gt; tuple[str, discord.File, View]:\n    # message content\n    trade_content = \"\"\n    if self.trade_player:\n        original_player = None\n        # we want to avoid calling fetch_user if possible (heavily rate-limited call)\n        if interaction.guild:\n            try:\n                original_player = await interaction.guild.fetch_member(int(self.trade_player.discord_id))\n            except discord.NotFound:\n                pass\n        elif original_player is None:  # try again if not found in guild\n            try:\n                original_player = await interaction.client.fetch_user(int(self.trade_player.discord_id))\n            except discord.NotFound:\n                pass\n\n        original_player_name = (\n            original_player.name if original_player else f\"user with ID {self.trade_player.discord_id}\"\n        )\n        trade_content = f\"Obtained by trade with {original_player_name}.\\n\"\n\n    catch_time: timedelta | None = (\n        self.catch_date - self.spawned_time if (self.catch_date and self.spawned_time) else None\n    )\n\n    catch_time_msg = f\" in {catch_time.total_seconds():.3f}s\" if catch_time else \"\"\n\n    content = (\n        f\"ID: `#{self.pk:0X}`\\n\"\n        f\"Caught on {format_dt(self.catch_date)}{catch_time_msg} ({format_dt(self.catch_date, style='R')}).\\n\"\n        f\"{trade_content}\\n\"\n        f\"ATK: {self.attack} ({self.attack_bonus:+d}%)\\n\"\n        f\"HP: {self.health} ({self.health_bonus:+d}%)\"\n    )\n\n    # draw image\n    with ThreadPoolExecutor() as pool:\n        buffer = await interaction.client.loop.run_in_executor(pool, self.draw_card)\n\n    view = View()\n    return content, discord.File(buffer, \"card.webp\"), view\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.short_description","title":"short_description","text":"<pre><code>short_description(*, is_trade: bool = False) -&gt; str\n</code></pre> <p>Return a short string representation. Similar to str(x) without arguments.</p> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def short_description(self, *, is_trade: bool = False) -&gt; str:\n    \"\"\"\n    Return a short string representation. Similar to str(x) without arguments.\n    \"\"\"\n    text = \"\"\n    if self.deleted:\n        text += \"\\N{NO ENTRY SIGN}\"\n    if not is_trade and self.locked and self.locked &gt; now() - timedelta(minutes=30):\n        text += \"\ud83d\udd12\"\n    if self.favorite:\n        text += settings.favorited_collectible_emoji\n    if text:\n        text += \" \"\n    if self.specialcard:\n        text += self.specialcard.emoji or \"\"\n    return f\"{text}#{self.pk:0X} {self.countryball.country}\"\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstance.unlock","title":"unlock","text":"<pre><code>unlock()\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def unlock(self):\n    self.locked = None  # type: ignore\n    await self.asave(update_fields=(\"locked\",))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstanceManager","title":"BallInstanceManager","text":"<p>               Bases: <code>BaseBallInstanceManager[T]</code></p>"},{"location":"dev/api/models/#bd_models.models.BallInstanceManager.get_queryset","title":"get_queryset","text":"<pre><code>get_queryset() -&gt; QuerySet[T]\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def get_queryset(self) -&gt; models.QuerySet[T]:\n    return super().get_queryset().filter(deleted=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BallInstanceManager.with_stats","title":"with_stats","text":"<pre><code>with_stats()\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def with_stats(self):\n    return self.annotate(\n        attack=Cast(\n            models.ExpressionWrapper(\n                F(\"ball__attack\")\n                * (models.Value(1.0) + Cast(F(\"attack_bonus\"), models.FloatField()) / models.Value(100.0)),\n                output_field=models.FloatField(),\n            ),\n            models.BigIntegerField(),\n        ),\n        health=Cast(\n            models.ExpressionWrapper(\n                F(\"ball__health\")\n                * (models.Value(1.0) + Cast(F(\"health_bonus\"), models.FloatField()) / models.Value(100.0)),\n                output_field=models.FloatField(),\n            ),\n            models.BigIntegerField(),\n        ),\n    )\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BaseBallInstanceManager","title":"BaseBallInstanceManager","text":"<p>               Bases: <code>Manager[T]</code></p>"},{"location":"dev/api/models/#bd_models.models.BaseBallInstanceManager.with_stats","title":"with_stats","text":"<pre><code>with_stats()\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def with_stats(self):\n    return self.annotate(\n        attack=Cast(\n            models.ExpressionWrapper(\n                F(\"ball__attack\")\n                * (models.Value(1.0) + Cast(F(\"attack_bonus\"), models.FloatField()) / models.Value(100.0)),\n                output_field=models.FloatField(),\n            ),\n            models.BigIntegerField(),\n        ),\n        health=Cast(\n            models.ExpressionWrapper(\n                F(\"ball__health\")\n                * (models.Value(1.0) + Cast(F(\"health_bonus\"), models.FloatField()) / models.Value(100.0)),\n                output_field=models.FloatField(),\n            ),\n            models.BigIntegerField(),\n        ),\n    )\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory","title":"BlacklistHistory","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.action_type","title":"action_type","text":"<pre><code>action_type = CharField(max_length=64, default='blacklist')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.date","title":"date","text":"<pre><code>date = DateTimeField(auto_now_add=True, editable=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.discord_id","title":"discord_id","text":"<pre><code>discord_id = BigIntegerField(help_text='Discord ID')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.id_type","title":"id_type","text":"<pre><code>id_type = CharField(max_length=64, default='user')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.moderator_id","title":"moderator_id","text":"<pre><code>moderator_id = BigIntegerField(help_text='Discord Moderator ID')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.reason","title":"reason","text":"<pre><code>reason = TextField(blank=True, null=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'blacklisthistory'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistHistory.Meta.verbose_name_plural","title":"verbose_name_plural","text":"<pre><code>verbose_name_plural = 'blacklisthistories'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild","title":"BlacklistedGuild","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.date","title":"date","text":"<pre><code>date = DateTimeField(blank=True, null=True, auto_now_add=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.discord_id","title":"discord_id","text":"<pre><code>discord_id = BigIntegerField(unique=True, help_text='Discord Guild ID')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.moderator_id","title":"moderator_id","text":"<pre><code>moderator_id = BigIntegerField(blank=True, null=True, default=None)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.reason","title":"reason","text":"<pre><code>reason = TextField(blank=True, null=True, default=None)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'blacklistedguild'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedGuild.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID","title":"BlacklistedID","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID.date","title":"date","text":"<pre><code>date = DateTimeField(blank=True, null=True, auto_now_add=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID.discord_id","title":"discord_id","text":"<pre><code>discord_id = BigIntegerField(unique=True, help_text='Discord user ID')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID.moderator_id","title":"moderator_id","text":"<pre><code>moderator_id = BigIntegerField(blank=True, null=True, default=None)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID.reason","title":"reason","text":"<pre><code>reason = TextField(blank=True, null=True, default=None)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.BlacklistedID.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'blacklistedid'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.BlacklistedID.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block","title":"Block","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Block.date","title":"date","text":"<pre><code>date = DateTimeField(auto_now_add=True, editable=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block.player1","title":"player1","text":"<pre><code>player1 = ForeignKey(Player, on_delete=CASCADE)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block.player1_id","title":"player1_id","text":"<pre><code>player1_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block.player2","title":"player2","text":"<pre><code>player2 = ForeignKey(Player, on_delete=CASCADE, related_name='block_player2_set')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block.player2_id","title":"player2_id","text":"<pre><code>player2_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Block.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'block'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Block.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Economy","title":"Economy","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Economy.icon","title":"icon","text":"<pre><code>icon = ImageField(max_length=200, help_text='512x512 PNG image')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Economy.name","title":"name","text":"<pre><code>name = CharField(max_length=64)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Economy.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Economy.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Economy.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'economy'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Economy.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Economy.Meta.verbose_name_plural","title":"verbose_name_plural","text":"<pre><code>verbose_name_plural = 'economies'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Economy.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return self.name\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.EnabledManager","title":"EnabledManager","text":"<p>               Bases: <code>Manager[T]</code></p>"},{"location":"dev/api/models/#bd_models.models.EnabledManager.get_queryset","title":"get_queryset","text":"<pre><code>get_queryset() -&gt; QuerySet[T]\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def get_queryset(self) -&gt; models.QuerySet[T]:\n    return super().get_queryset().filter(enabled=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship","title":"Friendship","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Friendship.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship.player1","title":"player1","text":"<pre><code>player1 = ForeignKey(Player, on_delete=CASCADE)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship.player1_id","title":"player1_id","text":"<pre><code>player1_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship.player2","title":"player2","text":"<pre><code>player2 = ForeignKey(Player, on_delete=CASCADE, related_name='friendship_player2_set')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship.player2_id","title":"player2_id","text":"<pre><code>player2_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship.since","title":"since","text":"<pre><code>since = DateTimeField(auto_now_add=True, editable=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Friendship.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'friendship'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Friendship.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig","title":"GuildConfig","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.admin_command_synced","title":"admin_command_synced","text":"<pre><code>admin_command_synced = BooleanField(help_text='True if slash admin commands are present in this server', default=False, editable=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.enabled","title":"enabled","text":"<pre><code>enabled = BooleanField(help_text='Whether the bot will spawn countryballs in this guild', default=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.guild_id","title":"guild_id","text":"<pre><code>guild_id = BigIntegerField(unique=True, help_text='Discord guild ID')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.silent","title":"silent","text":"<pre><code>silent = BooleanField(help_text='Whether the responses of guesses get sent as ephemeral or not', default=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.spawn_channel","title":"spawn_channel","text":"<pre><code>spawn_channel = BigIntegerField(null=True, help_text='Discord channel ID where balls will spawn')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.GuildConfig.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'guildconfig'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.GuildConfig.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return str(self.guild_id)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Manager","title":"Manager","text":"<p>               Bases: <code>from_queryset(QuerySet)</code></p>"},{"location":"dev/api/models/#bd_models.models.Player","title":"Player","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Player.balls","title":"balls","text":"<pre><code>balls: QuerySet[BallInstance]\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.can_be_mentioned","title":"can_be_mentioned","text":"<pre><code>can_be_mentioned: bool\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.discord_id","title":"discord_id","text":"<pre><code>discord_id = BigIntegerField(unique=True, help_text='Discord user ID')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.donation_policy","title":"donation_policy","text":"<pre><code>donation_policy = SmallIntegerField(choices=choices, help_text='How you want to handle donations', default=ALWAYS_ACCEPT)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.extra_data","title":"extra_data","text":"<pre><code>extra_data = JSONField(blank=True, default=dict)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.friend_policy","title":"friend_policy","text":"<pre><code>friend_policy = SmallIntegerField(choices=choices, help_text='Open or close your friend requests', default=ALLOW)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.mention_policy","title":"mention_policy","text":"<pre><code>mention_policy = SmallIntegerField(choices=choices, help_text=\"Control the bot's mentions\", default=ALLOW)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.money","title":"money","text":"<pre><code>money = PositiveBigIntegerField(help_text='Money posessed by the player', default=0)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.privacy_policy","title":"privacy_policy","text":"<pre><code>privacy_policy = SmallIntegerField(choices=choices, help_text='How you want to handle inventory privacy', default=DENY)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.trade_cooldown_policy","title":"trade_cooldown_policy","text":"<pre><code>trade_cooldown_policy = SmallIntegerField(choices=choices, help_text='To bypass or not the trade cooldown', default=COOLDOWN)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Player.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'player'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return f\"{'\\N{NO MOBILE PHONES} ' if self.is_blacklisted() else ''}#{self.pk} ({self.discord_id})\"\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.add_money","title":"add_money","text":"<pre><code>add_money(amount: int) -&gt; int\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def add_money(self, amount: int) -&gt; int:\n    if amount &lt;= 0:\n        raise ValueError(\"Amount to add must be positive\")\n    self.money += amount\n    await self.asave(update_fields=(\"money\",))\n    return self.money\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.can_afford","title":"can_afford","text":"<pre><code>can_afford(amount: int) -&gt; bool\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def can_afford(self, amount: int) -&gt; bool:\n    return self.money &gt;= amount\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.is_blacklisted","title":"is_blacklisted","text":"<pre><code>is_blacklisted() -&gt; bool\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def is_blacklisted(self) -&gt; bool:\n    # this should only be used for the admin panel\n    if \"startbot\" in sys.argv:\n        return False\n\n    blacklist = cast(\n        list[int],\n        cache.get_or_set(\n            \"blacklist\", BlacklistedID.objects.all().values_list(\"discord_id\", flat=True), timeout=300\n        ),\n    )\n    return self.discord_id in blacklist\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.is_blocked","title":"is_blocked","text":"<pre><code>is_blocked(other_player: 'Player') -&gt; bool\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def is_blocked(self, other_player: \"Player\") -&gt; bool:\n    return await Block.objects.filter((Q(player1=self) &amp; Q(player2=other_player))).aexists()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.is_friend","title":"is_friend","text":"<pre><code>is_friend(other_player: 'Player') -&gt; bool\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def is_friend(self, other_player: \"Player\") -&gt; bool:\n    return await Friendship.objects.filter(\n        (Q(player1=self) &amp; Q(player2=other_player)) | (Q(player1=other_player) &amp; Q(player2=self))\n    ).aexists()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Player.remove_money","title":"remove_money","text":"<pre><code>remove_money(amount: int) -&gt; None\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def remove_money(self, amount: int) -&gt; None:\n    if self.money &lt; amount:\n        raise ValueError(\"Not enough money\")\n    self.money -= amount\n    await self.asave(update_fields=(\"money\",))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.QuerySet","title":"QuerySet","text":"<p>               Bases: <code>QuerySet[T]</code></p>"},{"location":"dev/api/models/#bd_models.models.QuerySet.aall","title":"aall","text":"<pre><code>aall() -&gt; list[T]\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def aall(self) -&gt; list[T]:\n    return [x async for x in super().all()]\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.QuerySet.aget_or_none","title":"aget_or_none","text":"<pre><code>aget_or_none(*args: Any, **kwargs: Any) -&gt; T | None\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>async def aget_or_none(self, *args: Any, **kwargs: Any) -&gt; T | None:\n    try:\n        return await super().aget(*args, **kwargs)\n    except self.model.DoesNotExist:\n        return None\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.QuerySet.get_or_none","title":"get_or_none","text":"<pre><code>get_or_none(*args: Any, **kwargs: Any) -&gt; T | None\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def get_or_none(self, *args: Any, **kwargs: Any) -&gt; T | None:\n    try:\n        return super().get(*args, **kwargs)\n    except self.model.DoesNotExist:\n        return None\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Regime","title":"Regime","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Regime.background","title":"background","text":"<pre><code>background = ImageField(max_length=200, help_text='1428x2000 PNG image')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Regime.name","title":"name","text":"<pre><code>name = CharField(max_length=64)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Regime.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Regime.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Regime.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'regime'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Regime.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Regime.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return self.name\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special","title":"Special","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Special.background","title":"background","text":"<pre><code>background = ImageField(max_length=200, blank=True, null=True, help_text='1428x2000 PNG image')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.catch_phrase","title":"catch_phrase","text":"<pre><code>catch_phrase = CharField(max_length=128, blank=True, null=True, help_text='Sentence sent in bonus when someone catches a special card')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.credits","title":"credits","text":"<pre><code>credits = CharField(max_length=64, help_text='Author of the special event artwork', null=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.emoji","title":"emoji","text":"<pre><code>emoji = CharField(max_length=20, blank=True, null=True, help_text='Either a unicode character or a discord emoji ID')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.enabled_objects","title":"enabled_objects","text":"<pre><code>enabled_objects = SpecialEnabledManager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.end_date","title":"end_date","text":"<pre><code>end_date = DateTimeField(blank=True, null=True, help_text='End time of the event. If blank, the event is permanent')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.hidden","title":"hidden","text":"<pre><code>hidden = BooleanField(help_text='Hides the event from user commands', default=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.name","title":"name","text":"<pre><code>name = CharField(max_length=64)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.rarity","title":"rarity","text":"<pre><code>rarity = FloatField(help_text='Value between 0 and 1, chances of using this special background.')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.start_date","title":"start_date","text":"<pre><code>start_date = DateTimeField(blank=True, null=True, help_text='Start time of the event. If blank, starts immediately')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.tradeable","title":"tradeable","text":"<pre><code>tradeable = BooleanField(help_text='Whether balls of this event can be traded', default=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Special.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'special'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Special.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return self.name\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.SpecialEnabledManager","title":"SpecialEnabledManager","text":"<p>               Bases: <code>Manager['Special']</code></p>"},{"location":"dev/api/models/#bd_models.models.SpecialEnabledManager.get_queryset","title":"get_queryset","text":"<pre><code>get_queryset() -&gt; QuerySet[Special]\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def get_queryset(self) -&gt; models.QuerySet[Special]:\n    return super().get_queryset().filter(hidden=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade","title":"Trade","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.Trade.date","title":"date","text":"<pre><code>date = DateTimeField(auto_now_add=True, editable=False)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.player1","title":"player1","text":"<pre><code>player1 = ForeignKey(Player, on_delete=CASCADE)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.player1_id","title":"player1_id","text":"<pre><code>player1_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.player1_money","title":"player1_money","text":"<pre><code>player1_money = PositiveBigIntegerField(default=0)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.player2","title":"player2","text":"<pre><code>player2 = ForeignKey(Player, on_delete=CASCADE, related_name='trade_player2_set')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.player2_id","title":"player2_id","text":"<pre><code>player2_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.player2_money","title":"player2_money","text":"<pre><code>player2_money = PositiveBigIntegerField(default=0)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.tradeobject_set","title":"tradeobject_set","text":"<pre><code>tradeobject_set: QuerySet[TradeObject]\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.Trade.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'trade'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.Meta.indexes","title":"indexes","text":"<pre><code>indexes = (Index(fields=('player1_id',)), Index(fields=('player2_id',)))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.Trade.__str__","title":"__str__","text":"<pre><code>__str__() -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    return f\"Trade #{self.pk:0X}\"\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject","title":"TradeObject","text":"<p>               Bases: <code>Model</code></p>"},{"location":"dev/api/models/#bd_models.models.TradeObject.ballinstance","title":"ballinstance","text":"<pre><code>ballinstance = ForeignKey(BallInstance, on_delete=CASCADE)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.ballinstance_id","title":"ballinstance_id","text":"<pre><code>ballinstance_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.objects","title":"objects","text":"<pre><code>objects: Manager[Self] = Manager()\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.player","title":"player","text":"<pre><code>player = ForeignKey(Player, on_delete=CASCADE)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.player_id","title":"player_id","text":"<pre><code>player_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.trade","title":"trade","text":"<pre><code>trade = ForeignKey(Trade, on_delete=CASCADE)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.trade_id","title":"trade_id","text":"<pre><code>trade_id: int\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.Meta","title":"Meta","text":""},{"location":"dev/api/models/#bd_models.models.TradeObject.Meta.db_table","title":"db_table","text":"<pre><code>db_table = 'tradeobject'\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.Meta.indexes","title":"indexes","text":"<pre><code>indexes = (Index(fields=('ballinstance_id',)), Index(fields=('player_id',)), Index(fields=('trade_id',)))\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeObject.Meta.managed","title":"managed","text":"<pre><code>managed = True\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeableManager","title":"TradeableManager","text":"<p>               Bases: <code>BallInstanceManager[T]</code></p>"},{"location":"dev/api/models/#bd_models.models.TradeableManager.get_queryset","title":"get_queryset","text":"<pre><code>get_queryset() -&gt; QuerySet[T]\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def get_queryset(self) -&gt; models.QuerySet[T]:\n    return super().get_queryset().filter(tradeable=True)\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.TradeableManager.with_stats","title":"with_stats","text":"<pre><code>with_stats()\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def with_stats(self):\n    return self.annotate(\n        attack=Cast(\n            models.ExpressionWrapper(\n                F(\"ball__attack\")\n                * (models.Value(1.0) + Cast(F(\"attack_bonus\"), models.FloatField()) / models.Value(100.0)),\n                output_field=models.FloatField(),\n            ),\n            models.BigIntegerField(),\n        ),\n        health=Cast(\n            models.ExpressionWrapper(\n                F(\"ball__health\")\n                * (models.Value(1.0) + Cast(F(\"health_bonus\"), models.FloatField()) / models.Value(100.0)),\n                output_field=models.FloatField(),\n            ),\n            models.BigIntegerField(),\n        ),\n    )\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.image_display","title":"image_display","text":"<pre><code>image_display(image_link: str) -&gt; SafeText\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def image_display(image_link: str) -&gt; SafeText:\n    return mark_safe(f'&lt;img src=\"/media/{transform_media(image_link)}\" width=\"80%\" /&gt;')\n</code></pre>"},{"location":"dev/api/models/#bd_models.models.transform_media","title":"transform_media","text":"<pre><code>transform_media(path: str) -&gt; str\n</code></pre> Source code in <code>admin_panel/bd_models/models.py</code> <pre><code>def transform_media(path: str) -&gt; str:\n    return path.replace(\"/static/uploads/\", \"\").replace(\"/ballsdex/core/image_generator/src/\", \"default/\")\n</code></pre>"},{"location":"dev/api/utils/buttons/","title":"Buttons","text":""},{"location":"dev/api/utils/buttons/#ballsdex.core.utils.buttons","title":"ballsdex.core.utils.buttons","text":""},{"location":"dev/api/utils/buttons/#ballsdex.core.utils.buttons.ConfirmChoiceView","title":"ConfirmChoiceView","text":"<pre><code>ConfirmChoiceView(ctx: Interaction[BallsDexBot] | Context[BallsDexBot], user: User | None = None, accept_message: str = 'Confirmed', cancel_message: str = 'Cancelled')\n</code></pre> <p>               Bases: <code>View</code></p> <p>An utility to prompt the user for confirmation.</p> <p>Parameters:</p> <ul> <li> <code>ctx</code>               (<code>Interaction[BallsDexBot] | Context[BallsDexBot]</code>)           \u2013            <p>Either a context or interaction.</p> </li> <li> <code>user</code>               (<code>User | None</code>, default:                   <code>None</code> )           \u2013            <p>The user you're interacting with. If <code>None</code>, then <code>interaction.user</code> is used.</p> </li> <li> <code>accept_message</code>               (<code>str</code>, default:                   <code>'Confirmed'</code> )           \u2013            <p>The message appended to the message's content if the prompt is accepted.</p> </li> <li> <code>cancel_message</code>               (<code>str</code>, default:                   <code>'Cancelled'</code> )           \u2013            <p>The message appended to the message's content if the prompt is refused.</p> </li> </ul> <p>Attributes:</p> <ul> <li> <code>value</code>               (<code>bool | None</code>)           \u2013            <p>The user's choice. <code>None</code> if the interaction timed out or didn't finish. Call <code>wait()</code> first.</p> </li> </ul> Example <pre><code>view = ConfirmChoiceView(interaction)\nawait interaction.response.send_message(\"Are you sure?\", view=view)\nawait view.wait()\nif view.value is True:\n    # user accepted\nelif view.value is False:\n    # user denied\nelif view.value is None:\n    # timed out\n</code></pre> Source code in <code>ballsdex/core/utils/buttons.py</code> <pre><code>def __init__(\n    self,\n    ctx: discord.Interaction[\"BallsDexBot\"] | commands.Context[\"BallsDexBot\"],\n    user: Optional[discord.User] = None,\n    accept_message: str = \"Confirmed\",\n    cancel_message: str = \"Cancelled\",\n):\n    super().__init__(timeout=90)\n    self.value = None\n    if isinstance(ctx, discord.Interaction):\n        self.interaction = ctx\n        self.user = user or ctx.user\n    else:\n        self.interaction = ctx.interaction\n        self.user = user or ctx.author\n    self.interaction_response: discord.Interaction[\"BallsDexBot\"]\n    self.accept_message = accept_message\n    self.cancel_message = cancel_message\n    self.message: discord.Message | None = None\n</code></pre>"},{"location":"dev/api/utils/django/","title":"Database","text":""},{"location":"dev/api/utils/django/#ballsdex.core.utils.django","title":"ballsdex.core.utils.django","text":""},{"location":"dev/api/utils/django/#ballsdex.core.utils.django.row_count_estimate","title":"row_count_estimate","text":"<pre><code>row_count_estimate(table_name: str, *, analyze: bool = True) -&gt; int\n</code></pre> <p>Estimate the number of rows in a table. This is insanely faster than querying all rows, but the number given is an estimation, not the real value.</p> <p>Source</p> <p>Parameters:</p> <ul> <li> <code>table_name</code>               (<code>str</code>)           \u2013            <p>Name of the table which you want to get the row count of.</p> </li> <li> <code>analyze</code>               (<code>bool</code>, default:                   <code>True</code> )           \u2013            <p>If the returned number is wrong (<code>-1</code>), Postgres hasn't built a cache yet. When this happens, an <code>ANALYSE</code> query is sent to rebuild the cache. Set this parameter to <code>False</code> to prevent this and get a potential invalid result.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>int</code>           \u2013            <p>Estimated number of rows</p> </li> </ul> Source code in <code>ballsdex/core/utils/django.py</code> <pre><code>def row_count_estimate(table_name: str, *, analyze: bool = True) -&gt; int:\n    \"\"\"\n    Estimate the number of rows in a table. This is *insanely* faster than querying all rows,\n    but the number given is an estimation, not the real value.\n\n    [Source](https://stackoverflow.com/a/7945274)\n\n    Parameters\n    ----------\n    table_name: str\n        Name of the table which you want to get the row count of.\n    analyze: bool = True\n        If the returned number is wrong (`-1`), Postgres hasn't built a cache yet. When this\n        happens, an `ANALYSE` query is sent to rebuild the cache. Set this parameter to `False`\n        to prevent this and get a potential invalid result.\n\n    Returns\n    -------\n    int\n        Estimated number of rows\n    \"\"\"\n    with connection.cursor() as cursor:\n        # returns as a tuple the number of rows affected (always 1) and the result as a list\n        cursor.execute(f\"SELECT reltuples AS estimate FROM pg_class where relname = '{table_name}';\")\n        record = cursor.fetchone()\n\n        # Record type: https://magicstack.github.io/asyncpg/current/api/index.html#record-objects\n        result = int(record[0])  # type: ignore\n        if result == -1 and analyze is True:\n            # the cache wasn't built yet, let's ask for an analyze query\n            cursor.execute(f\"ANALYZE {table_name}\")\n            return row_count_estimate(table_name, analyze=False)  # prevent recursion error\n\n    return result\n</code></pre>"},{"location":"dev/api/utils/enums/","title":"Enums","text":""},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums","title":"ballsdex.core.utils.enums","text":""},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.DONATION_POLICY_MAP","title":"DONATION_POLICY_MAP","text":"<pre><code>DONATION_POLICY_MAP = {1: 'Accept all donations', 2: 'Approve donations', 3: 'Deny all donations', 4: 'Accept donations from friends only'}\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.FRIEND_POLICY_MAP","title":"FRIEND_POLICY_MAP","text":"<pre><code>FRIEND_POLICY_MAP = {1: 'Allow all friend requests', 2: 'Deny all friend requests'}\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.MENTION_POLICY_MAP","title":"MENTION_POLICY_MAP","text":"<pre><code>MENTION_POLICY_MAP = {1: 'Allow all mentions', 2: 'Deny all mentions'}\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.PRIVATE_POLICY_MAP","title":"PRIVATE_POLICY_MAP","text":"<pre><code>PRIVATE_POLICY_MAP = {1: 'Public', 2: 'Private', 3: 'Mutual Servers', 4: 'Friends'}\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.TRADE_COOLDOWN_POLICY_MAP","title":"TRADE_COOLDOWN_POLICY_MAP","text":"<pre><code>TRADE_COOLDOWN_POLICY_MAP = {1: 'Use 10s acceptance cooldown', 2: 'Bypass acceptance cooldown'}\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.FilteringChoices","title":"FilteringChoices","text":"<p>               Bases: <code>Enum</code></p>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.FilteringChoices.non_specials","title":"non_specials","text":"<pre><code>non_specials = 'non_special'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.FilteringChoices.only_specials","title":"only_specials","text":"<pre><code>only_specials = 'special'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.FilteringChoices.self_caught","title":"self_caught","text":"<pre><code>self_caught = 'self_caught'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.FilteringChoices.this_server","title":"this_server","text":"<pre><code>this_server = 'this_server'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices","title":"SortingChoices","text":"<p>               Bases: <code>Enum</code></p>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.alphabetic","title":"alphabetic","text":"<pre><code>alphabetic = 'ball__country'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.attack","title":"attack","text":"<pre><code>attack = 'attack'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.attack_bonus","title":"attack_bonus","text":"<pre><code>attack_bonus = '-attack_bonus'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.catch_date","title":"catch_date","text":"<pre><code>catch_date = '-catch_date'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.duplicates","title":"duplicates","text":"<pre><code>duplicates = 'manualsort-duplicates'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.health","title":"health","text":"<pre><code>health = 'health'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.health_bonus","title":"health_bonus","text":"<pre><code>health_bonus = '-health_bonus'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.rarity","title":"rarity","text":"<pre><code>rarity = 'ball__rarity'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.special","title":"special","text":"<pre><code>special = 'special__id'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.stats_bonus","title":"stats_bonus","text":"<pre><code>stats_bonus = 'stats'\n</code></pre>"},{"location":"dev/api/utils/enums/#ballsdex.core.utils.enums.SortingChoices.total_stats","title":"total_stats","text":"<pre><code>total_stats = 'total_stats'\n</code></pre>"},{"location":"dev/api/utils/formatting/","title":"Formatting","text":""},{"location":"dev/api/utils/formatting/#ballsdex.core.utils.formatting","title":"ballsdex.core.utils.formatting","text":""},{"location":"dev/api/utils/formatting/#ballsdex.core.utils.formatting.escape","title":"escape","text":"<pre><code>escape(text: str, *, mass_mentions: bool = False, formatting: bool = False) -&gt; str\n</code></pre> <p>Get text with all mass mentions or markdown escaped.</p> <p>Parameters:</p> <ul> <li> <code>text</code>               (<code>str</code>)           \u2013            <p>The text to be escaped.</p> </li> <li> <code>mass_mentions</code>               (<code>bool</code>, default:                   <code>False</code> )           \u2013            <p>Set to <code>True</code> to escape mass mentions in the text.</p> </li> <li> <code>formatting</code>               (<code>bool</code>, default:                   <code>False</code> )           \u2013            <p>Set to <code>True</code> to escape any markdown formatting in the text.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>str</code>           \u2013            <p>The escaped text.</p> </li> </ul> Source code in <code>ballsdex/core/utils/formatting.py</code> <pre><code>def escape(text: str, *, mass_mentions: bool = False, formatting: bool = False) -&gt; str:\n    \"\"\"\n    Get text with all mass mentions or markdown escaped.\n\n    Parameters\n    ----------\n    text: str\n        The text to be escaped.\n    mass_mentions: bool\n        Set to `True` to escape mass mentions in the text.\n    formatting: bool\n        Set to `True` to escape any markdown formatting in the text.\n\n    Returns\n    -------\n    str\n        The escaped text.\n    \"\"\"\n    if mass_mentions:\n        text = text.replace(\"@everyone\", \"@\\u200beveryone\")\n        text = text.replace(\"@here\", \"@\\u200bhere\")\n    if formatting:\n        text = discord.utils.escape_markdown(text)\n    return text\n</code></pre>"},{"location":"dev/api/utils/formatting/#ballsdex.core.utils.formatting.pagify","title":"pagify","text":"<pre><code>pagify(text: str, delims: Sequence[str] = ['\\n'], *, priority: bool = False, escape_mass_mentions: bool = True, shorten_by: int = 8, page_length: int = 2000, prefix: str = '', suffix: str = '') -&gt; Iterator[str]\n</code></pre> <p>Generate multiple pages from the given text.</p> <p>Parameters:</p> <ul> <li> <code>text</code>               (<code>str</code>)           \u2013            <p>The content to pagify and send.</p> </li> <li> <code>delims</code>               (<code>Sequence[str]</code>, default:                   <code>['\\n']</code> )           \u2013            <p>Characters where page breaks will occur. If no delimiters are found in a page, the page will break after <code>page_length</code> characters. By default this only contains the newline.</p> </li> </ul> <p>Other Parameters:</p> <ul> <li> <code>priority</code>               (<code>bool</code>)           \u2013            <p>Set to <code>True</code> to choose the page break delimiter based on the order of <code>delims</code>. Otherwise, the page will always break at the last possible delimiter.</p> </li> <li> <code>escape_mass_mentions</code>               (<code>bool</code>)           \u2013            <p>If <code>True</code>, any mass mentions (here or everyone) will be silenced.</p> </li> <li> <code>shorten_by</code>               (<code>int</code>)           \u2013            <p>How much to shorten each page by. Defaults to 8.</p> </li> <li> <code>page_length</code>               (<code>int</code>)           \u2013            <p>The maximum length of each page. Defaults to 2000.</p> </li> </ul> <p>Yields:</p> <ul> <li> <code>str</code>           \u2013            <p>Pages of the given text.</p> </li> </ul> Source code in <code>ballsdex/core/utils/formatting.py</code> <pre><code>def pagify(\n    text: str,\n    delims: Sequence[str] = [\"\\n\"],\n    *,\n    priority: bool = False,\n    escape_mass_mentions: bool = True,\n    shorten_by: int = 8,\n    page_length: int = 2000,\n    prefix: str = \"\",\n    suffix: str = \"\",\n) -&gt; Iterator[str]:\n    \"\"\"\n    Generate multiple pages from the given text.\n\n    Parameters\n    ----------\n    text: str\n        The content to pagify and send.\n    delims: Sequence[str]\n        Characters where page breaks will occur. If no delimiters are found\n        in a page, the page will break after `page_length` characters.\n        By default this only contains the newline.\n\n    Other Parameters\n    ----------------\n    priority: bool\n        Set to `True` to choose the page break delimiter based on the\n        order of `delims`. Otherwise, the page will always break at the\n        last possible delimiter.\n    escape_mass_mentions: bool\n        If `True`, any mass mentions (here or everyone) will be\n        silenced.\n    shorten_by: int\n        How much to shorten each page by. Defaults to 8.\n    page_length: int\n        The maximum length of each page. Defaults to 2000.\n\n    Yields\n    ------\n    str\n        Pages of the given text.\n    \"\"\"\n    in_text = text\n    page_length -= shorten_by + len(prefix) + len(suffix)\n    while len(in_text) &gt; page_length:\n        this_page_len = page_length\n        if escape_mass_mentions:\n            this_page_len -= in_text.count(\"@here\", 0, page_length) + in_text.count(\"@everyone\", 0, page_length)\n        closest_delim = (in_text.rfind(d, 1, this_page_len) for d in delims)\n        if priority:\n            closest_delim = next((x for x in closest_delim if x &gt; 0), -1)\n        else:\n            closest_delim = max(closest_delim)\n        closest_delim = closest_delim if closest_delim != -1 else this_page_len\n        if escape_mass_mentions:\n            to_send = escape(in_text[:closest_delim], mass_mentions=True)\n        else:\n            to_send = in_text[:closest_delim]\n        if len(to_send.strip()) &gt; 0:\n            yield f\"{prefix}{to_send}{suffix}\"\n        in_text = in_text[closest_delim:]\n\n    if len(in_text.strip()) &gt; 0:\n        in_text = f\"{prefix}{in_text}{suffix}\"\n        if escape_mass_mentions:\n            yield escape(in_text, mass_mentions=True)\n        else:\n            yield in_text\n</code></pre>"},{"location":"dev/api/utils/menus/","title":"Menus and paginators","text":""},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.menus","title":"ballsdex.core.utils.menus.menus","text":""},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.menus.Menu","title":"Menu","text":"<pre><code>Menu(bot: 'BallsDexBot', view: LayoutView, source: Source[P], *formatters: Formatter[P, Any])\n</code></pre> <p>A helper to have a pagination system inside of a <code>LayoutView</code>. It is possible to have multiple menus per view.</p> <p>A menu needs an instance of <code>Source</code> for the pagination, and one or more <code>Formatter</code>s which define how to display the current page. The source and formatters are not directly linked, but must follow the same type constraints, use your type checker to ensure you are using compatible classes.</p> <p>If there are multiple pages, then this class will add a row of buttons to the position you choose via <code>init</code>.</p> Example <p>Simple pagination for a select list, divided in sections of 25</p> <pre><code>from ballsdex.core.utils.menus import *\nfrom discord.ui import *\n\nmy_options = [...]\n\nview = discord.ui.LayoutView()\nselect = discord.ui.Select()\nview.add_item(select)\n\n# max number of options for a select is 25\nsource = ChunkedListSource(my_options, per_page=25)\n# the formatter is only linked to its UI element, not the source itself\nformatter = SelectFormatter(select)\n\nmenu = Menu(self.bot, view, source, formatter)\n# by default, this will add the control buttons at the end\nawait menu.init()\nawait interaction.response.send_message(view=view)\n</code></pre> <p>Another example with a list of <code>TextDisplay</code> items, dynamically sized to respect the view's limits</p> <pre><code>from ballsdex.core.utils.menus import *\nfrom discord.ui import *\n\nasync def generate_options():\n    async for item in queryset:\n        yield TextDisplay(\"## Item title\\nItem description...\")\n\nview = discord.ui.LayoutView()\ncontainer = discord.ui.Container()\ncontainer.add_item(Section(\n    TextDisplay(\"# Message title\"),\n    TextDisplay(\"Message subtitle\"),\n    accessory=Thumbnail(user.display_avatar_url),\n)\ncontainer.add_item(Separator())\n\nsource = ListSource(await dynamic_chunks(view, generate_options()))\nformatter = ItemFormatter(container, position=2)  # insert after separator\nmenu = Menu(self.bot, view, source, formatter)\nawait menu.init()\nawait interaction.response.send_message(view=view)\n</code></pre> Tip <p>Using a type checker can reveal incompatible types</p> <pre><code>from ballsdex.core.utils.menus import *\n\nsource = ModelSource(BallInstance.objects.filter(player=player))\nformatter = TextSource(item)\nmenu = Menu(self.bot, view, source, formatter)\n# Argument of type \"TextSource\" cannot be assigned to parameter \"formatters\" of type \"Formatter[P@Menu, Any]\" in function \"__init__\"\n#   \"TextSource\" is not assignable to \"Formatter[QuerySet[BallInstance], Any]\"\n</code></pre> <p>Parameters:</p> <ul> <li> <code>bot</code>               (<code>'BallsDexBot'</code>)           \u2013            <p>The bot instance. Unused by itself, but some formatters may find it useful to have it available.</p> </li> <li> <code>view</code>               (<code>LayoutView</code>)           \u2013            <p>The view you are attaching to. This is incompatible with V1 views.</p> </li> <li> <code>source</code>               (<code>Source[P]</code>)           \u2013            <p>The source instance providing the elements to paginate</p> </li> <li> <code>*formatters</code>               (<code>Formatter[P, Any]</code>, default:                   <code>()</code> )           \u2013            <p>One or more formatters which will display the data from the source. They are attached to an item that belongs to the view.</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/menus.py</code> <pre><code>def __init__(self, bot: \"BallsDexBot\", view: LayoutView, source: Source[P], *formatters: Formatter[P, Any]):\n    self.bot = bot\n    self.view = view\n    self.formatters = formatters\n    for formatter in formatters:\n        formatter.configure(self)\n    self.source = source\n    self.current_page = 0\n    self.controls = Controls(self)\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.menus.Menu.init","title":"init","text":"<pre><code>init(position: int | None = None, container: Container | None = None)\n</code></pre> <p>Prepare the menu before sending.</p> <p>Parameters:</p> <ul> <li> <code>position</code>               (<code>int | None</code>, default:                   <code>None</code> )           \u2013            <p>The position at which to insert the control buttons. If <code>None</code>, this will be at the end.</p> </li> <li> <code>container</code>               (<code>Container | None</code>, default:                   <code>None</code> )           \u2013            <p>If provided, the control buttons will be inserted inside the container instead of the outer view. The <code>position</code> parameter is respected within the container.</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/menus.py</code> <pre><code>async def init(self, position: int | None = None, container: discord.ui.Container | None = None):\n    \"\"\"\n    Prepare the menu before sending.\n\n    Parameters\n    ----------\n    position: int | None\n        The position at which to insert the control buttons. If `None`, this will be at the end.\n    container: discord.ui.Container | None\n        If provided, the control buttons will be inserted inside the container instead of the outer view. The\n        `position` parameter is respected within the container.\n    \"\"\"\n    await self.source.prepare()\n    await self.set_page(0)\n    if self.source.get_max_pages() &lt;= 1:\n        return\n    item = container or self.view\n    if not position:\n        item.add_item(self.controls)\n        return\n\n    # View only supports appending at the end, not inserting, so it's done manually\n    self.view._add_count(self.controls._total_count)\n    if position:\n        item._children.insert(position, self.controls)\n    else:\n        item._children.append(self.controls)\n    if container:\n        container._update_view(self.view)\n        self.controls._parent = container\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source","title":"ballsdex.core.utils.menus.source","text":""},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.Source","title":"Source","text":"<p>A source of long items to paginate and display over a <code>LayoutView</code>.</p>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.Source.get_max_pages","title":"get_max_pages","text":"<pre><code>get_max_pages() -&gt; int\n</code></pre> <p>Returns the maximum number of pages in the iterable.</p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>def get_max_pages(self) -&gt; int:\n    \"\"\"\n    Returns the maximum number of pages in the iterable.\n    \"\"\"\n    raise NotImplementedError\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.Source.get_page","title":"get_page","text":"<pre><code>get_page(page_number: int) -&gt; P\n</code></pre> <p>Returns one page of type <code>P</code>.</p> <p>Parameters:</p> <ul> <li> <code>page_number</code>               (<code>int</code>)           \u2013            <p>The page number requested. Cannot be negative, and strictly lower than the result of <code>get_max_pages</code>.</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>async def get_page(self, page_number: int) -&gt; P:\n    \"\"\"\n    Returns one page of type `P`.\n\n    Parameters\n    ----------\n    page_number: int\n        The page number requested. Cannot be negative, and strictly lower than the result of\n        `get_max_pages`.\n    \"\"\"\n    raise NotImplementedError\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.Source.prepare","title":"prepare","text":"<pre><code>prepare()\n</code></pre> <p>Called before starting the pagination.</p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>async def prepare(self):\n    \"\"\"\n    Called before starting the pagination.\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.ListSource","title":"ListSource","text":"<pre><code>ListSource(items: list[P])\n</code></pre> <p>               Bases: <code>Source[P]</code></p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>def __init__(self, items: list[P]):\n    super().__init__()\n    self.items = items\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.ListSource.prepare","title":"prepare","text":"<pre><code>prepare()\n</code></pre> <p>Called before starting the pagination.</p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>async def prepare(self):\n    \"\"\"\n    Called before starting the pagination.\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.ChunkedListSource","title":"ChunkedListSource","text":"<pre><code>ChunkedListSource(items: list[P], per_page: int = 25)\n</code></pre> <p>               Bases: <code>Source[list[P]]</code></p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>def __init__(self, items: list[P], per_page: int = 25):\n    super().__init__()\n    self.items = items\n    self.per_page = per_page\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.ChunkedListSource.prepare","title":"prepare","text":"<pre><code>prepare()\n</code></pre> <p>Called before starting the pagination.</p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>async def prepare(self):\n    \"\"\"\n    Called before starting the pagination.\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.TextSource","title":"TextSource","text":"<pre><code>TextSource(text: str, delims: Sequence[str] = ['\\n#', '\\n##', '\\n###', '\\n\\n', '\\n'], *, priority: bool = True, escape_mass_mentions: bool = True, shorten_by: int = 8, page_length: int = 3900, prefix: str = '', suffix: str = '')\n</code></pre> <p>               Bases: <code>ListSource[str]</code></p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>def __init__(\n    self,\n    text: str,\n    delims: Sequence[str] = [\"\\n#\", \"\\n##\", \"\\n###\", \"\\n\\n\", \"\\n\"],\n    *,\n    priority: bool = True,\n    escape_mass_mentions: bool = True,\n    shorten_by: int = 8,\n    page_length: int = 3900,\n    prefix: str = \"\",\n    suffix: str = \"\",\n):\n    pages = pagify(\n        text,\n        delims,\n        priority=priority,\n        escape_mass_mentions=escape_mass_mentions,\n        shorten_by=shorten_by,\n        page_length=page_length,\n        prefix=prefix,\n        suffix=suffix,\n    )\n    super().__init__(list(pages))\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.TextSource.get_max_pages","title":"get_max_pages","text":"<pre><code>get_max_pages() -&gt; int\n</code></pre> <p>Returns the maximum number of pages in the iterable.</p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>def get_max_pages(self) -&gt; int:\n    \"\"\"\n    Returns the maximum number of pages in the iterable.\n    \"\"\"\n    raise NotImplementedError\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.TextSource.get_page","title":"get_page","text":"<pre><code>get_page(page_number: int) -&gt; P\n</code></pre> <p>Returns one page of type <code>P</code>.</p> <p>Parameters:</p> <ul> <li> <code>page_number</code>               (<code>int</code>)           \u2013            <p>The page number requested. Cannot be negative, and strictly lower than the result of <code>get_max_pages</code>.</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>async def get_page(self, page_number: int) -&gt; P:\n    \"\"\"\n    Returns one page of type `P`.\n\n    Parameters\n    ----------\n    page_number: int\n        The page number requested. Cannot be negative, and strictly lower than the result of\n        `get_max_pages`.\n    \"\"\"\n    raise NotImplementedError\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.TextSource.prepare","title":"prepare","text":"<pre><code>prepare()\n</code></pre> <p>Called before starting the pagination.</p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>async def prepare(self):\n    \"\"\"\n    Called before starting the pagination.\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.source.ModelSource","title":"ModelSource","text":"<pre><code>ModelSource(queryset: QuerySet[M], per_page: int = 25)\n</code></pre> <p>               Bases: <code>Source['QuerySet[M]']</code></p> Source code in <code>ballsdex/core/utils/menus/source.py</code> <pre><code>def __init__(self, queryset: \"QuerySet[M]\", per_page: int = 25) -&gt; None:\n    super().__init__()\n    self.per_page = per_page\n    self.queryset = queryset\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.formatter","title":"ballsdex.core.utils.menus.formatter","text":""},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.formatter.Formatter","title":"Formatter","text":"<pre><code>Formatter(item: I)\n</code></pre> <p>A class that edits one of the layout's components from a page of the menu.</p> <p>Parameters:</p> <ul> <li> <code>item</code>               (<code>I</code>)           \u2013            <p>An item to edit from a page. Must be part of the view attached to the menu.</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/formatter.py</code> <pre><code>def __init__(self, item: I):\n    self.menu: \"Menu[P]\"\n    self.item = item\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.formatter.Formatter.format_page","title":"format_page","text":"<pre><code>format_page(page: P) -&gt; None\n</code></pre> <p>Edits the <code>item</code> attached with the given page.</p> <p>Parameters:</p> <ul> <li> <code>page</code>               (<code>P</code>)           \u2013            <p>The current page of the menu</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/formatter.py</code> <pre><code>async def format_page(self, page: P) -&gt; None:\n    \"\"\"\n    Edits the `item` attached with the given page.\n\n    Parameters\n    ----------\n    page: P\n        The current page of the menu\n    \"\"\"\n    raise NotImplementedError\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.formatter.ItemFormatter","title":"ItemFormatter","text":"<pre><code>ItemFormatter(item: Container, position: int, footer: bool = True)\n</code></pre> <p>               Bases: <code>Formatter[Iterable[Item], Container]</code></p> <p>This formatter takes as source a list of UI items, and dynamically add them to the given container. Useful for iterations where a list of <code>Section</code> or <code>TextDisplay</code> need to be given.</p> <p>You are responsible of passing a list of items that respect the container limits. Use <code>dynamic_chunks</code> to pagify your items while respecting limits.</p> <p>Parameters:</p> <ul> <li> <code>item</code>               (<code>Container</code>)           \u2013            <p>Must be of container type.</p> </li> <li> <code>position</code>               (<code>int</code>)           \u2013            <p>The position at which items must be inserted.</p> </li> <li> <code>footer</code>               (<code>bool</code>, default:                   <code>True</code> )           \u2013            <p>Whether to include a \"Page 1/max\" footer at the end.</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/formatter.py</code> <pre><code>def __init__(self, item: discord.ui.Container, position: int, footer: bool = True):\n    super().__init__(item)\n    self.position = position\n    self.footer = footer\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.utils","title":"ballsdex.core.utils.menus.utils","text":""},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.utils.dynamic_chunks","title":"dynamic_chunks","text":"<pre><code>dynamic_chunks[I: Item](view: LayoutView, source: AsyncIterable[I]) -&gt; list[list[I]]\n</code></pre> <p>Transform an iterable of <code>Item</code>s into a list of lists. Each sublist is guaranteed to fit the limits of the view given as argument.</p> <p>This is useful combined with <code>ItemFormatter</code> to display a dynamically-sized list of items.</p> Warning <p>This will ensure the limits of the view are respected at the time this function is called. Do not append new items to your view after calling this function as the results will be inaccurate.</p> <p>Parameters:</p> <ul> <li> <code>view</code>               (<code>LayoutView</code>)           \u2013            <p>The finished view that will have the items appended to. The position does not matter as it only checks for global limits.</p> </li> <li> <code>source</code>               (<code>AsyncIterable[I]</code>)           \u2013            <p>The generator providing the items. This is asynchronous in case you are doing this along an asynchronous iterator, like a database query or a Discord paginator.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>list[list[I]]</code>           \u2013            <p>The chunked list of items.</p> </li> </ul> Source code in <code>ballsdex/core/utils/menus/utils.py</code> <pre><code>async def dynamic_chunks[I: discord.ui.Item](view: discord.ui.LayoutView, source: AsyncIterable[I]) -&gt; list[list[I]]:\n    \"\"\"\n    Transform an iterable of [`Item`][discord.ui.Item]s into a list of lists. Each sublist is guaranteed to fit the\n    limits of the view given as argument.\n\n    This is useful combined with [`ItemFormatter`][ballsdex.core.utils.menus.ItemFormatter] to display a\n    dynamically-sized list of items.\n\n    Warning\n    -------\n    This will ensure the limits of the view are respected at the time this function is called. Do not append new\n    items to your view after calling this function as the results will be inaccurate.\n\n    Parameters\n    ----------\n    view: discord.ui.LayoutView\n        The finished view that will have the items appended to. The position does not matter as it only checks for\n        global limits.\n    source: AsyncIterable[I]\n        The generator providing the items. This is asynchronous in case you are doing this along an asynchronous\n        iterator, like a database query or a Discord paginator.\n\n    Returns\n    -------\n    list[list[I]]\n        The chunked list of items.\n    \"\"\"\n    sections = []\n    current_chunk = []\n    async for item in source:\n        view.add_item(item)\n        current_chunk.append(item)\n        if view.content_length() &gt; 5900 or view.total_children_count &gt; 30:\n            sections.append(current_chunk)\n            for old_item in current_chunk:\n                view.remove_item(old_item)\n            current_chunk = []\n    if current_chunk:\n        sections.append(current_chunk)\n        for old_item in current_chunk:\n            view.remove_item(old_item)\n    return sections\n</code></pre>"},{"location":"dev/api/utils/menus/#ballsdex.core.utils.menus.utils.iter_to_async","title":"iter_to_async","text":"<pre><code>iter_to_async[T](source: Iterable[T]) -&gt; AsyncIterable[T]\n</code></pre> <p>A helper to transform a synchronous iterable into an asynchronous one, useful for <code>dynamic_chunks</code>.</p> Source code in <code>ballsdex/core/utils/menus/utils.py</code> <pre><code>async def iter_to_async[T](source: Iterable[T]) -&gt; AsyncIterable[T]:\n    \"\"\"\n    A helper to transform a synchronous iterable into an asynchronous one, useful for `dynamic_chunks`.\n    \"\"\"\n    for x in source:\n        yield x\n</code></pre>"},{"location":"dev/api/utils/sorting/","title":"Sorting","text":""},{"location":"dev/api/utils/sorting/#ballsdex.core.utils.sorting","title":"ballsdex.core.utils.sorting","text":""},{"location":"dev/api/utils/sorting/#ballsdex.core.utils.sorting.filter_balls","title":"filter_balls","text":"<pre><code>filter_balls(filter: FilteringChoices, queryset: QuerySet[BallInstance], guild_id: int | None = None) -&gt; QuerySet[BallInstance]\n</code></pre> <p>Edit a list of ball instances in place to apply the selected filtering options.</p> <p>Parameters:</p> <ul> <li> <code>filter</code>               (<code>FilteringChoices</code>)           \u2013            <p>One of the supported filtering methods</p> </li> <li> <code>queryset</code>               (<code>QuerySet[BallInstance]</code>)           \u2013            <p>A ballinstance queryset.</p> </li> <li> <code>guild_id</code>               (<code>int | None</code>, default:                   <code>None</code> )           \u2013            <p>The ID of the server to filter by. Only used for the <code>this_server</code> filter. If not provided, this filter will be ignored.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>QuerySet[BallInstance]</code>           \u2013            <p>The modified query applying the filtering.</p> </li> </ul> Source code in <code>ballsdex/core/utils/sorting.py</code> <pre><code>def filter_balls(\n    filter: FilteringChoices, queryset: \"QuerySet[BallInstance]\", guild_id: int | None = None\n) -&gt; \"QuerySet[BallInstance]\":\n    \"\"\"\n    Edit a list of ball instances in place to apply the selected filtering options.\n\n    Parameters\n    ----------\n    filter: FilteringChoices\n        One of the supported filtering methods\n    queryset: QuerySet[BallInstance]\n        A ballinstance queryset.\n    guild_id: int | None\n        The ID of the server to filter by. Only used for the ``this_server`` filter.\n        If not provided, this filter will be ignored.\n\n    Returns\n    -------\n    QuerySet[BallInstance]\n        The modified query applying the filtering.\n    \"\"\"\n    if filter == FilteringChoices.only_specials:\n        return queryset.exclude(special=None)\n    elif filter == FilteringChoices.non_specials:\n        return queryset.filter(special=None)\n    elif filter == FilteringChoices.self_caught:\n        return queryset.filter(trade_player=None)\n    elif filter == FilteringChoices.this_server and guild_id is not None:\n        return queryset.filter(server_id=guild_id)\n    else:\n        return queryset\n</code></pre>"},{"location":"dev/api/utils/sorting/#ballsdex.core.utils.sorting.sort_balls","title":"sort_balls","text":"<pre><code>sort_balls[QS: QuerySet[BallInstance]](sort: SortingChoices, queryset: QS) -&gt; QS\n</code></pre> <p>Edit a queryset in place to apply the selected sorting options. You can call this function multiple times with the same queryset to have multiple sort methods.</p> <p>Parameters:</p> <ul> <li> <code>sort</code>               (<code>SortingChoices</code>)           \u2013            <p>One of the supported sorting methods</p> </li> <li> <code>queryset</code>               (<code>QS</code>)           \u2013            <p>An existing queryset of ball instances. This can be obtained with, for example, <code>BallInstance.all()</code> or <code>BallInstance.filter(player=x)</code> without awaiting the result!</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>QuerySet[BallInstance]</code>           \u2013            <p>The same queryset modified to apply the ordering. Await it to obtain the result.</p> </li> </ul> Source code in <code>ballsdex/core/utils/sorting.py</code> <pre><code>def sort_balls[QS: QuerySet[BallInstance]](sort: SortingChoices, queryset: QS) -&gt; QS:\n    \"\"\"\n    Edit a queryset in place to apply the selected sorting options. You can call this function\n    multiple times with the same queryset to have multiple sort methods.\n\n    Parameters\n    ----------\n    sort: SortingChoices\n        One of the supported sorting methods\n    queryset: QuerySet[BallInstance]\n        An existing queryset of ball instances. This can be obtained with, for example,\n        ``BallInstance.all()`` or ``BallInstance.filter(player=x)``\n        **without awaiting the result!**\n\n    Returns\n    -------\n    QuerySet[BallInstance]\n        The same queryset modified to apply the ordering. Await it to obtain the result.\n    \"\"\"\n    if sort == SortingChoices.duplicates:\n        return queryset.annotate(count=RawSQL(\"COUNT(*) OVER (PARTITION BY ball_id)\", ())).order_by(\"-count\")\n    elif sort == SortingChoices.stats_bonus:\n        return queryset.annotate(stats_bonus=F(\"health_bonus\") + F(\"attack_bonus\")).order_by(\"-stats_bonus\")\n    elif sort == SortingChoices.health or sort == SortingChoices.attack:\n        # Use the sorting name as the annotation key to avoid issues when this function\n        # is called multiple times. Using the same annotation name twice will error.\n        return queryset.annotate(\n            **{f\"{sort.value}_sort\": F(f\"{sort.value}_bonus\") + F(f\"ball__{sort.value}\")}\n        ).order_by(f\"-{sort.value}_sort\")\n    elif sort == SortingChoices.total_stats:\n        return (\n            queryset.select_related(\"ball\")\n            .annotate(stats=RawSQL(\"ball.health + ball.attack :: BIGINT\", ()))\n            .order_by(\"-stats\")\n        )\n    elif sort == SortingChoices.rarity:\n        return queryset.order_by(sort.value, \"ball__country\")\n    else:\n        return queryset.order_by(sort.value)\n</code></pre>"},{"location":"dev/api/utils/transformers/","title":"Transformers","text":""},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers","title":"ballsdex.core.utils.transformers","text":"<p>This file contains discord.py transformers used to provide autocompletion, parsing and validation for various Ballsdex models.</p>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.ModelTransformer","title":"ModelTransformer","text":"<pre><code>ModelTransformer(**filters: Any)\n</code></pre> <p>               Bases: <code>Transformer</code>, <code>Converter</code></p> <p>Base abstract class for autocompletion from on Django models</p> <p>This also works with hybrid commands.</p> <p>Attributes:</p> <ul> <li> <code>name</code>               (<code>str</code>)           \u2013            <p>Name to qualify the object being listed</p> </li> <li> <code>column</code>               (<code>str</code>)           \u2013            <p>Column of the model to use for matching text-based conversions. Defaults to \"name\".</p> </li> <li> <code>model</code>               (<code>T</code>)           \u2013            <p>The Django model associated to the class derivation</p> </li> <li> <code>base</code>               (<code>int</code>)           \u2013            <p>The base in which database IDs are converted. Defaults to decimal (10).</p> </li> </ul> <p>Parameters:</p> <ul> <li> <code>**filters</code>               (<code>Any</code>, default:                   <code>{}</code> )           \u2013            <p>Filters to apply on the model before providing options.</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def __init__(self, **filters: Any):\n    self.filters = filters\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.ModelTransformer.get_from_pk","title":"get_from_pk","text":"<pre><code>get_from_pk(value: int) -&gt; T\n</code></pre> <p>Return a Django model instance from a primary key.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_pk(self, value: int) -&gt; T:\n    \"\"\"\n    Return a Django model instance from a primary key.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(pk=value)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.ModelTransformer.get_from_text","title":"get_from_text","text":"<pre><code>get_from_text(value: str) -&gt; T\n</code></pre> <p>Return a Django model instance from the raw value entered.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_text(self, value: str) -&gt; T:\n    \"\"\"\n    Return a Django model instance from the raw value entered.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(**{f\"{self.column}__iexact\": value})\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.ModelTransformer.get_options","title":"get_options","text":"<pre><code>get_options(interaction: Interaction[BallsDexBot], value: str) -&gt; list[Choice[int]]\n</code></pre> <p>Generate the list of options for autocompletion</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_options(\n    self, interaction: discord.Interaction[\"BallsDexBot\"], value: str\n) -&gt; list[app_commands.Choice[int]]:\n    \"\"\"\n    Generate the list of options for autocompletion\n    \"\"\"\n    raise NotImplementedError()\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.ModelTransformer.key","title":"key","text":"<pre><code>key(model: T) -&gt; str\n</code></pre> <p>Return a string used for searching while sending autocompletion suggestions.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def key(self, model: T) -&gt; str:\n    \"\"\"\n    Return a string used for searching while sending autocompletion suggestions.\n    \"\"\"\n    return getattr(model, self.column)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.ModelTransformer.validate","title":"validate","text":"<pre><code>validate(ctx: Context[BallsDexBot], item: T)\n</code></pre> <p>A function to validate the fetched item before calling back the command.</p> <p>Raises:</p> <ul> <li> <code>BadArgument</code>             \u2013            <p>Raised if the item does not pass validation with the message to be displayed</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def validate(self, ctx: commands.Context[\"BallsDexBot\"], item: T):\n    \"\"\"\n    A function to validate the fetched item before calling back the command.\n\n    Raises\n    ------\n    commands.BadArgument\n        Raised if the item does not pass validation with the message to be displayed\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallInstanceTransformer","title":"BallInstanceTransformer","text":"<pre><code>BallInstanceTransformer(**filters: Any)\n</code></pre> <p>               Bases: <code>ModelTransformer[BallInstance]</code></p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def __init__(self, **filters: Any):\n    self.filters = filters\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallInstanceTransformer.key","title":"key","text":"<pre><code>key(model: T) -&gt; str\n</code></pre> <p>Return a string used for searching while sending autocompletion suggestions.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def key(self, model: T) -&gt; str:\n    \"\"\"\n    Return a string used for searching while sending autocompletion suggestions.\n    \"\"\"\n    return getattr(model, self.column)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.TTLModelTransformer","title":"TTLModelTransformer","text":"<pre><code>TTLModelTransformer(**filters: Any)\n</code></pre> <p>               Bases: <code>ModelTransformer[T]</code></p> <p>Base class for simple Django model autocompletion with TTL cache.</p> <p>This is used in most cases except for BallInstance which requires special handling depending on the interaction passed.</p> <p>Attributes:</p> <ul> <li> <code>ttl</code>               (<code>float</code>)           \u2013            <p>Delay in seconds for <code>items</code> to live until refreshed with <code>load_items</code>, defaults to 300</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def __init__(self, **filters: Any):\n    super().__init__(**filters)\n    self.items: dict[int, T] = {}\n    self.search_map: dict[T, str] = {}\n    self.last_refresh: float = 0\n    log.debug(f\"Inited transformer for {self.name}\")\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.TTLModelTransformer.get_from_pk","title":"get_from_pk","text":"<pre><code>get_from_pk(value: int) -&gt; T\n</code></pre> <p>Return a Django model instance from a primary key.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_pk(self, value: int) -&gt; T:\n    \"\"\"\n    Return a Django model instance from a primary key.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(pk=value)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.TTLModelTransformer.get_from_text","title":"get_from_text","text":"<pre><code>get_from_text(value: str) -&gt; T\n</code></pre> <p>Return a Django model instance from the raw value entered.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_text(self, value: str) -&gt; T:\n    \"\"\"\n    Return a Django model instance from the raw value entered.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(**{f\"{self.column}__iexact\": value})\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.TTLModelTransformer.key","title":"key","text":"<pre><code>key(model: T) -&gt; str\n</code></pre> <p>Return a string used for searching while sending autocompletion suggestions.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def key(self, model: T) -&gt; str:\n    \"\"\"\n    Return a string used for searching while sending autocompletion suggestions.\n    \"\"\"\n    return getattr(model, self.column)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.TTLModelTransformer.load_items","title":"load_items","text":"<pre><code>load_items() -&gt; Iterable[T]\n</code></pre> <p>Query values to fill <code>items</code> with.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def load_items(self) -&gt; Iterable[T]:\n    \"\"\"\n    Query values to fill `items` with.\n    \"\"\"\n    return [x async for x in self.get_queryset()]\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.TTLModelTransformer.validate","title":"validate","text":"<pre><code>validate(ctx: Context[BallsDexBot], item: T)\n</code></pre> <p>A function to validate the fetched item before calling back the command.</p> <p>Raises:</p> <ul> <li> <code>BadArgument</code>             \u2013            <p>Raised if the item does not pass validation with the message to be displayed</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def validate(self, ctx: commands.Context[\"BallsDexBot\"], item: T):\n    \"\"\"\n    A function to validate the fetched item before calling back the command.\n\n    Raises\n    ------\n    commands.BadArgument\n        Raised if the item does not pass validation with the message to be displayed\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallTransformer","title":"BallTransformer","text":"<pre><code>BallTransformer(**filters: Any)\n</code></pre> <p>               Bases: <code>TTLModelTransformer[Ball]</code></p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def __init__(self, **filters: Any):\n    self.filters = filters\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallTransformer.get_from_pk","title":"get_from_pk","text":"<pre><code>get_from_pk(value: int) -&gt; T\n</code></pre> <p>Return a Django model instance from a primary key.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_pk(self, value: int) -&gt; T:\n    \"\"\"\n    Return a Django model instance from a primary key.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(pk=value)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallTransformer.get_from_text","title":"get_from_text","text":"<pre><code>get_from_text(value: str) -&gt; T\n</code></pre> <p>Return a Django model instance from the raw value entered.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_text(self, value: str) -&gt; T:\n    \"\"\"\n    Return a Django model instance from the raw value entered.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(**{f\"{self.column}__iexact\": value})\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallTransformer.get_options","title":"get_options","text":"<pre><code>get_options(interaction: Interaction[BallsDexBot], value: str) -&gt; list[Choice[int]]\n</code></pre> <p>Generate the list of options for autocompletion</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_options(\n    self, interaction: discord.Interaction[\"BallsDexBot\"], value: str\n) -&gt; list[app_commands.Choice[int]]:\n    \"\"\"\n    Generate the list of options for autocompletion\n    \"\"\"\n    raise NotImplementedError()\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallTransformer.key","title":"key","text":"<pre><code>key(model: T) -&gt; str\n</code></pre> <p>Return a string used for searching while sending autocompletion suggestions.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def key(self, model: T) -&gt; str:\n    \"\"\"\n    Return a string used for searching while sending autocompletion suggestions.\n    \"\"\"\n    return getattr(model, self.column)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallTransformer.load_items","title":"load_items","text":"<pre><code>load_items() -&gt; Iterable[T]\n</code></pre> <p>Query values to fill <code>items</code> with.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def load_items(self) -&gt; Iterable[T]:\n    \"\"\"\n    Query values to fill `items` with.\n    \"\"\"\n    return [x async for x in self.get_queryset()]\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.BallTransformer.validate","title":"validate","text":"<pre><code>validate(ctx: Context[BallsDexBot], item: T)\n</code></pre> <p>A function to validate the fetched item before calling back the command.</p> <p>Raises:</p> <ul> <li> <code>BadArgument</code>             \u2013            <p>Raised if the item does not pass validation with the message to be displayed</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def validate(self, ctx: commands.Context[\"BallsDexBot\"], item: T):\n    \"\"\"\n    A function to validate the fetched item before calling back the command.\n\n    Raises\n    ------\n    commands.BadArgument\n        Raised if the item does not pass validation with the message to be displayed\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.SpecialTransformer","title":"SpecialTransformer","text":"<pre><code>SpecialTransformer(**filters: Any)\n</code></pre> <p>               Bases: <code>TTLModelTransformer[Special]</code></p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def __init__(self, **filters: Any):\n    self.filters = filters\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.SpecialTransformer.get_from_pk","title":"get_from_pk","text":"<pre><code>get_from_pk(value: int) -&gt; T\n</code></pre> <p>Return a Django model instance from a primary key.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_pk(self, value: int) -&gt; T:\n    \"\"\"\n    Return a Django model instance from a primary key.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(pk=value)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.SpecialTransformer.get_from_text","title":"get_from_text","text":"<pre><code>get_from_text(value: str) -&gt; T\n</code></pre> <p>Return a Django model instance from the raw value entered.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_text(self, value: str) -&gt; T:\n    \"\"\"\n    Return a Django model instance from the raw value entered.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(**{f\"{self.column}__iexact\": value})\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.SpecialTransformer.get_options","title":"get_options","text":"<pre><code>get_options(interaction: Interaction[BallsDexBot], value: str) -&gt; list[Choice[int]]\n</code></pre> <p>Generate the list of options for autocompletion</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_options(\n    self, interaction: discord.Interaction[\"BallsDexBot\"], value: str\n) -&gt; list[app_commands.Choice[int]]:\n    \"\"\"\n    Generate the list of options for autocompletion\n    \"\"\"\n    raise NotImplementedError()\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.SpecialTransformer.key","title":"key","text":"<pre><code>key(model: T) -&gt; str\n</code></pre> <p>Return a string used for searching while sending autocompletion suggestions.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def key(self, model: T) -&gt; str:\n    \"\"\"\n    Return a string used for searching while sending autocompletion suggestions.\n    \"\"\"\n    return getattr(model, self.column)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.SpecialTransformer.load_items","title":"load_items","text":"<pre><code>load_items() -&gt; Iterable[T]\n</code></pre> <p>Query values to fill <code>items</code> with.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def load_items(self) -&gt; Iterable[T]:\n    \"\"\"\n    Query values to fill `items` with.\n    \"\"\"\n    return [x async for x in self.get_queryset()]\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.SpecialTransformer.validate","title":"validate","text":"<pre><code>validate(ctx: Context[BallsDexBot], item: T)\n</code></pre> <p>A function to validate the fetched item before calling back the command.</p> <p>Raises:</p> <ul> <li> <code>BadArgument</code>             \u2013            <p>Raised if the item does not pass validation with the message to be displayed</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def validate(self, ctx: commands.Context[\"BallsDexBot\"], item: T):\n    \"\"\"\n    A function to validate the fetched item before calling back the command.\n\n    Raises\n    ------\n    commands.BadArgument\n        Raised if the item does not pass validation with the message to be displayed\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.RegimeTransformer","title":"RegimeTransformer","text":"<pre><code>RegimeTransformer(**filters: Any)\n</code></pre> <p>               Bases: <code>TTLModelTransformer[Regime]</code></p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def __init__(self, **filters: Any):\n    self.filters = filters\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.RegimeTransformer.get_from_pk","title":"get_from_pk","text":"<pre><code>get_from_pk(value: int) -&gt; T\n</code></pre> <p>Return a Django model instance from a primary key.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_pk(self, value: int) -&gt; T:\n    \"\"\"\n    Return a Django model instance from a primary key.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(pk=value)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.RegimeTransformer.get_from_text","title":"get_from_text","text":"<pre><code>get_from_text(value: str) -&gt; T\n</code></pre> <p>Return a Django model instance from the raw value entered.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_text(self, value: str) -&gt; T:\n    \"\"\"\n    Return a Django model instance from the raw value entered.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(**{f\"{self.column}__iexact\": value})\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.RegimeTransformer.get_options","title":"get_options","text":"<pre><code>get_options(interaction: Interaction[BallsDexBot], value: str) -&gt; list[Choice[int]]\n</code></pre> <p>Generate the list of options for autocompletion</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_options(\n    self, interaction: discord.Interaction[\"BallsDexBot\"], value: str\n) -&gt; list[app_commands.Choice[int]]:\n    \"\"\"\n    Generate the list of options for autocompletion\n    \"\"\"\n    raise NotImplementedError()\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.RegimeTransformer.key","title":"key","text":"<pre><code>key(model: T) -&gt; str\n</code></pre> <p>Return a string used for searching while sending autocompletion suggestions.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def key(self, model: T) -&gt; str:\n    \"\"\"\n    Return a string used for searching while sending autocompletion suggestions.\n    \"\"\"\n    return getattr(model, self.column)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.RegimeTransformer.load_items","title":"load_items","text":"<pre><code>load_items() -&gt; Iterable[T]\n</code></pre> <p>Query values to fill <code>items</code> with.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def load_items(self) -&gt; Iterable[T]:\n    \"\"\"\n    Query values to fill `items` with.\n    \"\"\"\n    return [x async for x in self.get_queryset()]\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.RegimeTransformer.validate","title":"validate","text":"<pre><code>validate(ctx: Context[BallsDexBot], item: T)\n</code></pre> <p>A function to validate the fetched item before calling back the command.</p> <p>Raises:</p> <ul> <li> <code>BadArgument</code>             \u2013            <p>Raised if the item does not pass validation with the message to be displayed</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def validate(self, ctx: commands.Context[\"BallsDexBot\"], item: T):\n    \"\"\"\n    A function to validate the fetched item before calling back the command.\n\n    Raises\n    ------\n    commands.BadArgument\n        Raised if the item does not pass validation with the message to be displayed\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.EconomyTransformer","title":"EconomyTransformer","text":"<pre><code>EconomyTransformer(**filters: Any)\n</code></pre> <p>               Bases: <code>TTLModelTransformer[Economy]</code></p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def __init__(self, **filters: Any):\n    self.filters = filters\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.EconomyTransformer.get_from_pk","title":"get_from_pk","text":"<pre><code>get_from_pk(value: int) -&gt; T\n</code></pre> <p>Return a Django model instance from a primary key.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_pk(self, value: int) -&gt; T:\n    \"\"\"\n    Return a Django model instance from a primary key.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(pk=value)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.EconomyTransformer.get_from_text","title":"get_from_text","text":"<pre><code>get_from_text(value: str) -&gt; T\n</code></pre> <p>Return a Django model instance from the raw value entered.</p> <p>Raises:</p> <ul> <li> <code>KeyError | DoesNotExist</code>             \u2013            <p>Entry does not exist</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_from_text(self, value: str) -&gt; T:\n    \"\"\"\n    Return a Django model instance from the raw value entered.\n\n    Raises\n    ------\n    KeyError | django.db.models.Model.DoesNotExist\n        Entry does not exist\n    \"\"\"\n    return await self.get_queryset().aget(**{f\"{self.column}__iexact\": value})\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.EconomyTransformer.get_options","title":"get_options","text":"<pre><code>get_options(interaction: Interaction[BallsDexBot], value: str) -&gt; list[Choice[int]]\n</code></pre> <p>Generate the list of options for autocompletion</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def get_options(\n    self, interaction: discord.Interaction[\"BallsDexBot\"], value: str\n) -&gt; list[app_commands.Choice[int]]:\n    \"\"\"\n    Generate the list of options for autocompletion\n    \"\"\"\n    raise NotImplementedError()\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.EconomyTransformer.key","title":"key","text":"<pre><code>key(model: T) -&gt; str\n</code></pre> <p>Return a string used for searching while sending autocompletion suggestions.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>def key(self, model: T) -&gt; str:\n    \"\"\"\n    Return a string used for searching while sending autocompletion suggestions.\n    \"\"\"\n    return getattr(model, self.column)\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.EconomyTransformer.load_items","title":"load_items","text":"<pre><code>load_items() -&gt; Iterable[T]\n</code></pre> <p>Query values to fill <code>items</code> with.</p> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def load_items(self) -&gt; Iterable[T]:\n    \"\"\"\n    Query values to fill `items` with.\n    \"\"\"\n    return [x async for x in self.get_queryset()]\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.EconomyTransformer.validate","title":"validate","text":"<pre><code>validate(ctx: Context[BallsDexBot], item: T)\n</code></pre> <p>A function to validate the fetched item before calling back the command.</p> <p>Raises:</p> <ul> <li> <code>BadArgument</code>             \u2013            <p>Raised if the item does not pass validation with the message to be displayed</p> </li> </ul> Source code in <code>ballsdex/core/utils/transformers.py</code> <pre><code>async def validate(self, ctx: commands.Context[\"BallsDexBot\"], item: T):\n    \"\"\"\n    A function to validate the fetched item before calling back the command.\n\n    Raises\n    ------\n    commands.BadArgument\n        Raised if the item does not pass validation with the message to be displayed\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/api/utils/transformers/#ballsdex.core.utils.transformers.TradeCommandType","title":"TradeCommandType","text":"<p>               Bases: <code>Enum</code></p> <p>If a command is using <code>BallInstanceTransformer</code> for trading purposes, it should define this enum to filter out values.</p>"},{"location":"dev/api/utils/utils/","title":"Utility functions","text":""},{"location":"dev/api/utils/utils/#ballsdex.core.utils.utils","title":"ballsdex.core.utils.utils","text":""},{"location":"dev/api/utils/utils/#ballsdex.core.utils.utils.can_mention","title":"can_mention","text":"<pre><code>can_mention(players: list[Player]) -&gt; AllowedMentions\n</code></pre> Source code in <code>ballsdex/core/utils/utils.py</code> <pre><code>async def can_mention(players: List[Player]) -&gt; discord.AllowedMentions:\n    can_mention = []\n    for player in players:\n        if player.can_be_mentioned:\n            can_mention.append(discord.Object(id=player.discord_id))\n    return discord.AllowedMentions(users=can_mention, roles=False, everyone=False)\n</code></pre>"},{"location":"dev/api/utils/utils/#ballsdex.core.utils.utils.inventory_privacy","title":"inventory_privacy","text":"<pre><code>inventory_privacy(bot: BallsDexBot, interaction: Interaction[BallsDexBot], player: Player, user_obj: User | Member)\n</code></pre> <p>Check if the inventory of a user is viewable in the given context. If not, a followup response will be sent with a proper message.</p> <p>Parameters:</p> <ul> <li> <code>bot</code>               (<code>BallsDexBot</code>)           \u2013            <p>Bot object</p> </li> <li> <code>interaction</code>               (<code>Interaction[BallsDexBot]</code>)           \u2013            <p>Interaction of the command.</p> </li> <li> <code>player</code>               (<code>Player</code>)           \u2013            <p>Ballsdex Player object of the user whose inventory is being inspected.</p> </li> <li> <code>user_obj</code>               (<code>User | Member</code>)           \u2013            <p>Discord user object of the user whose inventory is being inspected.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>bool</code>           \u2013            <p><code>True</code> if the inventory can be viewed, else <code>False</code>. If this is <code>False</code>, you should exit the command.</p> </li> </ul> Source code in <code>ballsdex/core/utils/utils.py</code> <pre><code>async def inventory_privacy(\n    bot: \"BallsDexBot\",\n    interaction: discord.Interaction[\"BallsDexBot\"],\n    player: Player,\n    user_obj: Union[discord.User, discord.Member],\n):\n    \"\"\"\n    Check if the inventory of a user is viewable in the given context. If not, a followup response will be sent with a\n    proper message.\n\n    Parameters\n    ----------\n    bot: BallsDexBot\n        Bot object\n    interaction: Interaction[BallsDexBot]\n        Interaction of the command.\n    player: Player\n        Ballsdex Player object of the user whose inventory is being inspected.\n    user_obj: discord.User | discord.Member\n        Discord user object of the user whose inventory is being inspected.\n\n    Returns\n    -------\n    bool\n        [`True`][] if the inventory can be viewed, else [`False`][].\n        If this is [`False`][], you should exit the command.\n    \"\"\"\n    privacy_policy = player.privacy_policy\n    interacting_player, _ = await Player.objects.aget_or_create(discord_id=interaction.user.id)\n    if interaction.user.id == player.discord_id:\n        return True\n    if await is_staff(interaction):\n        return True\n    if privacy_policy == PrivacyPolicy.DENY:\n        await interaction.followup.send(\"This user has set their inventory to private.\", ephemeral=True)\n        return False\n    elif privacy_policy == PrivacyPolicy.FRIENDS:\n        if not await interacting_player.is_friend(player):\n            await interaction.followup.send(\n                \"This users inventory can only be viewed from users they have added as friends.\", ephemeral=True\n            )\n            return False\n    elif privacy_policy == PrivacyPolicy.SAME_SERVER:\n        if not bot.intents.members:\n            await interaction.followup.send(\n                \"This user has their policy set to `Same Server`, \"\n                \"however I do not have the `members` intent to check this.\",\n                ephemeral=True,\n            )\n            return False\n        if interaction.guild is None:\n            await interaction.followup.send(\"This user has set their inventory to private.\", ephemeral=True)\n            return False\n        elif interaction.guild.get_member(user_obj.id) is None:\n            await interaction.followup.send(\"This user is not in the server.\", ephemeral=True)\n            return False\n    return True\n</code></pre>"},{"location":"dev/api/utils/utils/#ballsdex.core.utils.utils.is_staff","title":"is_staff","text":"<pre><code>is_staff(interaction: Interaction[BallsDexBot], *perms: str) -&gt; bool\n</code></pre> <p>Checks if an interacting user checks one of the following conditions:</p> <ul> <li>The user is a bot owner</li> <li>The user has a role considered root or admin</li> </ul> <p>Parameters:</p> <ul> <li> <code>interaction</code>               (<code>Interaction[BallsDexBot]</code>)           \u2013            <p>The interaction of the user to check.</p> </li> <li> <code>perms</code>               (<code>str</code>, default:                   <code>()</code> )           \u2013            <p>Django permissions to verify. If empty, only staff status will be checked.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>bool</code>           \u2013            <p><code>True</code> if the user is a staff, <code>False</code> otherwise.</p> </li> </ul> Source code in <code>ballsdex/core/utils/utils.py</code> <pre><code>async def is_staff(interaction: discord.Interaction[\"BallsDexBot\"], *perms: str) -&gt; bool:\n    \"\"\"\n    Checks if an interacting user checks one of the following conditions:\n\n    - The user is a bot owner\n    - The user has a role considered root or admin\n\n    Parameters\n    ----------\n    interaction: Interaction[BallsDexBot]\n        The interaction of the user to check.\n    perms: *str\n        Django permissions to verify. If empty, only staff status will be checked.\n\n    Returns\n    -------\n    bool\n        [`True`][] if the user is a staff, [`False`][] otherwise.\n    \"\"\"\n    user = await get_user_for_check(interaction.client, interaction.user)\n    if isinstance(user, bool):\n        return user\n    if not user.is_staff:\n        return False\n    return await user.ahas_perms(perms)\n</code></pre>"},{"location":"selfhosting/","title":"Installing BallsDex-DiscordBot","text":"<p>For installation instructions, please refer to the Installing BallsDex-DiscordBot page.</p> <p>For more advanced users who wish not to use Docker, you can refer to the Installing BallsDex-DiscordBot without Docker page.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/","title":"Exposing to internet","text":"<p>If you want to leverage your experience and be able to access your admin panel from anywhere and share it with your staff, you can host it on a server and expose it to the internet! It's not an easy process but I will try to guide you there.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#1-requirements","title":"1. Requirements","text":""},{"location":"selfhosting/admin-panel/exposing-to-internet/#pre-requirements","title":"Pre-requirements","text":""},{"location":"selfhosting/admin-panel/exposing-to-internet/#ballsdex-hosted-on-an-online-linux-server","title":"Ballsdex hosted on an online Linux server","text":"<p>It is extremely important that you do not host Ballsdex or the website on your own personal network. This would require you to open your firewall and expose your entire family to tons of dangers. DO NOT DO THIS and look for a provider, there are even free options.</p> <p>I recommend checking this page for VPS and server recommendations.</p> <p>The reason Linux is a requirement in this tutorial is simply because I don't know how this works on Windows or macOS, I cannot teach that. Besides, it would be weird to pay an additional sum for a paid OS when Linux is the recommended OS.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#your-own-domain-name","title":"Your own domain name","text":"<p>You must have a domain name to hide your IP. This is pretty cheap honestly, I recommend you to use Namecheap for cheap domain names, it's what I use myself.</p> <p>Once you got this, you should also use Cloudflare as a DNS and proxy provider, it's free, faster than the default DNS, and comes with many good features. Your server's IP will be hidden thanks to that.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#docker-managed-ballsdex","title":"Docker-managed Ballsdex","text":"<p>In this tutorial, we will only cover Docker installations of Ballsdex.</p> <p>If you are not using Docker, you will need to configure nginx yourself to serve the static files.</p> <p>Caution</p> <p>It is very important that you follow these requirements, they have security implications. Failing to follow these will result in being exposed to a lot of risks and vulnerabilities if you don't exactly know what you're doing and how it works.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#routing-your-domain-name","title":"Routing your domain name","text":"<p>On Cloudflare, create a new configuration for your domain <code>example.com</code>. It will ask you to replace nameservers with its own on Namecheap's side. Do this and wait for the changes to take effect (can take a while).</p> <p>Once Cloudflare is ready, go to the DNS page, create an <code>A</code> record and redirect it to your server's IP. If you don't know your server's IP, you can run <code>curl http://ipinfo.io/ip</code>. Be sure to tick \"Proxy\" on.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#using-https","title":"Using HTTPS","text":"<p>To have secure connections, it is highly recommended to have HTTPS connections. Luckily, Cloudflare can handle that for us.</p> <ol> <li>In Cloudflare's settings, open SSL/TLS Overview in the sidebar</li> <li>Next to \"SSL/TLS encryption\", click Configure</li> <li>Choose \"Automatic\". It should have at least \"Flexible\" mode on.</li> </ol> <p>If you want to have full end-to-end encryption, you can have a strict policy and generate your own certificates using <code>certbot</code>. Tutorial</p> <p>Warning</p> <p>Using unsecure HTTP to access your admin panel is dangerous. All traffic between you and the server is readable by anyone in-between, including passwords.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#program-requirements","title":"Program requirements","text":"<p>We are going to use the <code>pwgen</code> to generate secret keys.On Debian/Ubuntu, run this: <pre><code>sudo apt update\nsudo apt install pwgen\n</code></pre></p> <p>If you are using a different distribution, look up your package manager to see how to install those dependencies.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#2-setting-up-a-firewall","title":"2. Setting up a firewall","text":"<p>Before opening yourself to the internet, ensure that your OS is configured to only allow what we need.</p> <p>Distributions have different firewall programs, but the most common one is <code>ufw</code> (preinstalled on Ubuntu). Let's configure it together.</p> <ol> <li>Disallow all incoming connections: <code>sudo ufw default deny incoming</code></li> <li>Allow all outgoing connections: <code>sudo ufw default allow outgoing</code></li> <li>Allow SSH connections: <code>sudo ufw allow OpenSSH</code></li> <li>Allow HTTP and HTTPS connections: <code>sudo ufw allow 'Nginx Full'</code></li> <li>Enable ufw: <code>sudo ufw enable</code></li> </ol> <p>If you do not have <code>ufw</code> on your system, look up what program is recommended for your distribution and allow ports 22 and 80.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#3-configuring-the-ballsdex-admin-panel","title":"3. Configuring the Ballsdex admin panel","text":"<p>We're slowly getting there! Now we just need to configure the last few bits on Ballsdex's side.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#configure-the-production-settings","title":"Configure the production settings","text":"<p>In production, we need different settings for Django. An example <code>production.py</code> file is provided, which we will copy and fill. Open a shell and type the following commands:</p> <ol> <li><code>cd config</code></li> <li><code>cp production.example.py production.py</code></li> <li>Generate a random string of characters with <code>pwgen -n 64 1</code> and copy that</li> <li><code>nano production.py</code> (or your preferred editor)</li> <li>Find the line that says <code>SECRET_KEY = None</code> and replace it with <code>SECRET_KEY = \"paste your random string here\"</code></li> <li>Look down for the <code>ALLOWED_HOSTS</code> section and replace <code>localhost</code> by your domain</li> <li>Exit and save with Ctrl+x, <code>yes</code> and enter.</li> </ol> <p>This <code>production.py</code> file should remain secret and never be pushed. It will be ignored by git.</p> <p>Warning</p> <p>Keep your <code>SECRET_KEY</code> secret. Running Django with a known <code>SECRET_KEY</code> defeats many of Django\u2019s security protections, and can lead to privilege escalation and remote code execution vulnerabilities. https://docs.djangoproject.com/en/5.1/ref/settings/#secret-key</p> <p>Tip</p> <p>Feel free to edit the <code>production.py</code> file to extend the configuration and add more settings, such as extensions or custom admin themes. Future updates will change settings in <code>base.py</code> and <code>production_base.py</code> and automatically apply to your configuration.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#telling-django-about-your-settings","title":"Telling Django about your settings","text":"<p>To make use of that <code>production.py</code> file, you need to tell Django via the <code>DJANGO_SETTINGS_MODULE</code> environment variable.</p> <p>You will find in <code>docker-compose.yml</code> there is already a commented environment variable, simply uncomment that line. If you're not using docker compose, simply run <code>export DJANGO_SETTINGS_MODULE=config.production</code> before running the server.</p> <p>At this point, restart your admin panel and you should now be able to access it at your domain name, in https, from anywhere!</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#next-steps","title":"Next steps","text":"<p>Now that your admin panel is online, there are some additional settings that may interest you.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#discord-oauth2","title":"Discord OAuth2","text":"<p>If you followed the first guide, you may have configured Discord OAuth2 to login with Discord and not create accounts. This now applies to your staff too! Here's how the Discord pipeline works:</p> <ul> <li>Does the user have Two-factor authentication enabled?</li> <li>If not, login is immediately denied.</li> <li>Is the user ID in the <code>co-owners</code> section of <code>config.yml</code>?</li> <li>If yes, the user is granted the superuser status.</li> <li>Is the user ID the owner of the Discord application?</li> <li>If yes, the user is granted the superuser status.</li> <li>Is <code>team-members-are-owners</code> set to <code>true</code> in <code>config.yml</code>, and is the user ID part of the Discord developer team that owns the application (regardless of its role)?</li> <li>If yes, the user is granted the superuser status.</li> <li>Does the user possess one of the roles defined in <code>root-role-ids</code> in <code>config.yml</code>?</li> <li>If yes, the user is granted the staff status and is assigned the Admin group (detailed below).</li> <li>Does the user possess one of the roles defined in <code>admin-role-ids</code> in <code>config.yml</code>?</li> <li>If yes, the user is granted the staff status and is assigned the Staff group (detailed below).</li> </ul> <p>If you have configured a Discord webhook, you will be notified for each new user that registers successfully on your admin panel. It is highly recommended to have this setup!</p> <p>Danger</p> <p>Here's the very important part, staff status is not automatically unassigned if you demote a user in Discord!!</p> <p>When demoting someone (admin/root role removed, removed from the Developer team or the <code>co-owners</code> list), you must also go to the admin panel, \"Users\", edit the user (if they registered on the panel) and untick the \"Is Active\" box. You do not need to untick \"Is staff\", \"Is superuser\" or remove permissions groups. Unticking \"Is Active\" completely disables logging in and invalidates all sessions. If you want to re-enable the user, simply tick this box back.</p> <p>It is important that you do not delete the user, or you will be losing all audit logs!</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#disabling-discord-oauth2","title":"Disabling Discord OAuth2","text":"<p>If you prefer creating admin accounts yourself and not automatically give access to all your staff, you can disable the \"Login with Discord\" button by adding the following lines to your <code>production.py</code> file:</p> <pre><code>AUTHENTICATION_BACKENDS = [\n    # \"social_core.backends.discord.DiscordOAuth2\",\n    \"django.contrib.auth.backends.ModelBackend\",\n]\n</code></pre> <p>Simply uncomment the line if you want to re-enable this.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#creating-new-accounts","title":"Creating new accounts","text":"<p>Whether you have Discord OAuth2 or not, you can always choose to create manual admin accounts with a login and a password.</p> <p>For that, open the admin panel and click the \"+ Add\" button next to \"Users\". Choose a login and a password. Once created, you can then edit the user's permissions. It is recommended that you ask users to reset their password as soon as they login for the first time. They can do so by clicking the button on the top right of the admin panel.</p> <p>Warning</p> <p>If you need to delete a user, do not actually delete it as you will be losing all audit logs! Instead, untick the \"Is active\" checkbox, that will prevent them from logging in and invalidate all existing sessions. To re-enable access, simply tick that box again. The previous permissions will apply.</p>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#creating-a-superuser-account-from-the-command-line","title":"Creating a superuser account from the command line","text":"<p>If you need to create a new superuser account without accessing the admin panel (for instance, the first admin account), you can use the following command and follow the prompts.</p> <ul> <li>With docker: <code>docker compose exec admin-panel python3 -m django createsuperuser</code></li> <li>Without docker: <code>DJANGO_SETTINGS_MODULE=admin_panel.settings python3 -m django createsuperuser</code></li> </ul>"},{"location":"selfhosting/admin-panel/exposing-to-internet/#disabling-password-authentication","title":"Disabling password authentication","text":"<p>If you want to exclusively rely on Discord OAuth2 for authentication, you can disable password-based accounts by adding the following lines to your <code>production.py</code> file:</p> <pre><code>AUTHENTICATION_BACKENDS = [\n    \"social_core.backends.discord.DiscordOAuth2\",\n    # \"django.contrib.auth.backends.ModelBackend\",\n]\n</code></pre> <p>Simply uncomment the line if you want to re-enable this.</p>"},{"location":"selfhosting/admin-panel/getting-started/","title":"Getting started","text":""},{"location":"selfhosting/admin-panel/getting-started/#starting-the-panel","title":"Starting the panel","text":"<p>If you are running Docker, the panel may already be running. Just do <code>docker compose up -d proxy</code> to start if it's not running.</p> <p>Without docker, the command to start the admin panel is <code>DJANGO_SETTINGS_MODULE=admin_panel.settings python3 -m django migrate &amp;&amp; uvicorn admin_panel.asgi:application</code></p> <p>The panel will then be accessible at http://localhost:8000</p>"},{"location":"selfhosting/admin-panel/getting-started/#configuring-the-panel","title":"Configuring the panel","text":"<p>Before using this panel, you must configure a way to login. You can either enable the \"Login with Discord\" button, or use accounts with a password (or both).</p>"},{"location":"selfhosting/admin-panel/getting-started/#using-local-accounts","title":"Using local accounts","text":"<p>The easiest way to login is to create accounts with a login and a password. Run the commands below and follow the prompts.</p> With DockerWithout Docker <pre><code>docker compose up -d admin-panel\ndocker compose exec admin-panel python3 -m django createsuperuser\n</code></pre> <pre><code>DJANGO_SETTINGS_MODULE=admin_panel.settings python3 -m django createsuperuser\n</code></pre> <p>Then you can login using the chosen credentials at http://localhost:8000. Additional accounts can be created from the admin panel.</p>"},{"location":"selfhosting/admin-panel/getting-started/#using-discord-oauth2-login-with-discord","title":"Using Discord OAuth2 (login with Discord)","text":"<p>This will only let the bot owner access the admin panel when logged in, no need to remember any password. You still need a classic account to configure this on the panel.</p> <ol> <li>Open the Bot's settings in one tab</li> <li>Go to the Discord developer portal and click on your application</li> <li>Click the \"OAuth\" tab</li> <li>Copy the application ID and paste it in the \"Client ID\" field of the settings</li> <li>Generate your application secret and paste it in the \"Client Secret\" field of the settings</li> <li>Save the settings on the admin panel</li> <li>Add a new redirect URI: <code>http://localhost:8000/complete/discord/</code> (the trailing slash is important)</li> <li>Save the changes on the Discord panel</li> </ol> <p>Danger</p> <p>Keep your application secret hidden at all times, it must never be shared (like your bot token)! If you have suspicion this file was leaked, immediately reset it in your developer portal.</p> <p>In addition, you can also create a webhook for notifications from the admin panel, such as a new user registering or more in the future. This is optional but recommended:</p> <ol> <li>Go to a Discord text channel that's only viewable by you or other admins</li> <li>Open the settings, then the integrations menu, then create a Webhook</li> <li>Copy the URL, and paste it in the \"Webhook\" field of the admin panel settings</li> </ol> <p>You should now be good to go. Run <code>docker compose up -d proxy</code> to start the admin panel (if it was already running, restart it), and open http://localhost:8000/ in your browser. Click the \"Login with Discord\" button and follow the steps. If you are the bot owner, then you will have the superuser status automatically assigned.</p> <p>Developer teams</p> <p>If the application is owned by a team, tick \"Team members are owners\" in the settings, otherwise you won't get access.</p>"},{"location":"selfhosting/admin-panel/getting-started/#using-the-panel","title":"Using the panel","text":"<p>Once you are logged in, you will see the panel's home page, with multiple options appearing on the sidebar.</p> <p>The \"Authentication and authorization\" section should be ignored unless you serve the panel on the internet, it contains the user accounts and permission groups. \"Python social auth\" should also be ignored and not tampered with, it contains the Discord OAuth2 data that allows you to login.</p> <p>The \"Ballsdex models\" section is what you are looking for, it has all the models from the bot:</p> <ul> <li><code>BallInstances</code> represents instances of a ball that were obtained by a player. You can use that to give balls to players, delete then, modify attributes or look at its trade history. Searching via hexadecimal ID is supported.</li> <li><code>Balls</code> is where you create your countryballs (or whatever your bot is themed after). It's the first thing you want to visit, more details below.</li> <li><code>Economies</code> is for the little icon on the top right of cards. By default, you'll have communist and capitalist economies (but you can set none).</li> <li><code>Players</code> contains the list of all players. You can change their settings, view their inventory, trade history, or latest catches (to hunt for farmers). Searching by Discord ID works.</li> <li><code>Regimes</code> represents the backgrounds of your cards. Each ball must have a regime assigned. By default you have 3 available: democracy, dictatorship and union.</li> <li><code>Specials</code> is for making some ball instances special with a custom background and a special catching phrase. They can have start and end dates for limited-time events, a custom phrase to display when caught, and ofc the special background to apply. Using a rarity of 0 renders it unobtainable by the public, but can still be applied by admins.</li> <li><code>Trades</code> has the list of all trades performed. Clicking on a trade will show all of its contents.</li> </ul> <p>Info</p> <p>The admin panel will always use the Ballsdex vocabulary (countryballs). If you have set a custom name for your bot or your collectibles, don't worry, they will be used throughout the bot itself.</p>"},{"location":"selfhosting/admin-panel/getting-started/#creating-your-first-countryball","title":"Creating your first countryball","text":"<p>Click the \"Add\" button next to \"Balls\", or click the \"Add ball\" button on the top left if you have opened the balls tab. You will be presented with a form to fill. If the label on the left side is bold, it means a value is required, otherwise it's optional.</p>"},{"location":"selfhosting/admin-panel/getting-started/#base-fields","title":"Base fields","text":"<ul> <li><code>Country</code>: The name of your collectible</li> <li><code>Health</code> and <code>Attack</code>: Base stats, they will be applied a +/-20% bonus when caught (customizable in <code>config.yml</code>)</li> <li><code>Rarity</code>: Defines how rare the ball will be when spawning. Setting a rarity of 0 will make the ball unspawnable (but it will still appear in completion and user commands!). Check this page to understand how rarity works.</li> <li><code>Emoji ID</code>: The ID of your ball's emoji. You can upload application emojis from the Discord developer portal, click your bot and go to the \"Emojis\" tab. Emojis from servers shared by the bot are also supported.</li> <li><code>Economy</code>: The icon at the top right of your card. You can leave this blank.</li> <li><code>Regime</code>: Sets the background of your card, this is required.</li> </ul>"},{"location":"selfhosting/admin-panel/getting-started/#assets","title":"Assets","text":"<p>Then you have a section for assets. You must upload two files:</p> <ul> <li><code>Wild card</code>: The file that will be sent in the chat when the ball spawns. It's usually a file, but you can upload a video, a GIF, an mp3... anything that embeds in Discord.</li> <li><code>Collection card</code>: The image used when generating the card. The size of the image should be 1359x731, or a ratio of approximatively 18:10 (it is automatically resized and centered).</li> <li><code>Credits</code>: This is where you credit the artists of both uploaded assets.</li> </ul> <p>Danger</p> <p>\u26a0\ufe0f You must have the permission to use the images you are uploading!! \u26a0\ufe0f</p> <p>Not everything you find on Google is free to use, unless it is clearly labelled as Creative commons (there is a filter in Google images for that). Unless you are the artist, you must have explicit permission from the artist to use their assets in your bot. This may come at the cost of a license.</p> <p>Violating licenses exposes you to a DMCA complaint, which can lead to both your bot and your own account getting banned from Discord.</p> <p>All art used by Ballsdex is licensed to the Ballsdex Team and cannot be reused by other bots without permission from their artists. However, the MIT-licensed files included in the bot repository (such as the default backgrounds) are free to use.</p>"},{"location":"selfhosting/admin-panel/getting-started/#ability","title":"Ability","text":"<p>Finally, you have two fields, <code>Capacity name</code> and <code>Capacity description</code>, which actually refer to the ability name and description. My english wasn't as good back then, and it's hard to change it now.</p>"},{"location":"selfhosting/admin-panel/getting-started/#advanced","title":"Advanced","text":"<p>If you unroll this section, you will find a few settings you probably don't need at first.</p> <ul> <li><code>Enabled</code>: If unticked, the ball will not spawn (regardless of rarity), appear in <code>/balls completion</code> or appear in user-facing commands. You can still spawn it or give it manually using <code>/admin</code> commands or this panel.</li> <li><code>Tradeable</code>: If unticked, any instance of this ball won't be tradeable at all.</li> <li><code>Short Name</code>: When the name is so long that it overflows in the card, you can use this field to choose a shorter name that will be only used in card generation. This is limited to 12 characters.</li> <li><code>Catch names</code>: A list of additional names, lowercased and separated by semicolons, that can be used to catch this countryball when spawned. The main name remains usable for catching. It is important to not leave any space between the semicolons or this will break.</li> <li><code>Translations</code>: This has the exact same effect as <code>Catch names</code>. The reason this exists is to automatically update translations without breaking additional catch names (like abbreviations).</li> <li><code>Capacity logic</code>: A JSON field of extra data, currently unused. This is planned to be used for the battle system.</li> </ul> <p>Once you have filled everything needed, click the \"Save and continue editing\" button, this will show you a preview of what the card looks like in the sidebar! Once you're satisfied with the result, go to Discord and send <code>b.reloadcache</code> to your bot, and your ball should start spawning.</p> <p>Success</p> <p>It is always a good idea to test spawn your ball with <code>/admin balls spawn</code> and ensure it works as intended.</p> <p>Tip</p> <p>You can edit rarities and enable balls in bulk from the list of balls. There is a save button at the end.</p> <p>Caution</p> <p>Deleting a ball will delete all ball instances associated. This may be an extremely slow operation, and it is not reversible!</p>"},{"location":"selfhosting/admin-panel/getting-started/#creating-your-first-special","title":"Creating your first special","text":"<p>A \"special\" is a way to override the attributes of a ball instance to make it special. When a ball is caught, it may gain an active special based on its rarity. By default, you will have one special named \"Shiny\" with a chance of 1/2048 to happen. If you do not want shinies on your bot, it is safe to delete it from this panel.</p> <p>Specials can have a start and end date to indicate that it will be limited in time, but you can also omit those to have a special active permanently.</p> <p>Warning</p> <p>If you want to end a special from being active, do not delete it as all ball instances will lose the special attribute. Instead, configure the end date or set its rarity to 0.</p>"},{"location":"selfhosting/admin-panel/getting-started/#base-fields_1","title":"Base fields","text":"<ul> <li><code>Name</code>: The name of this special</li> <li><code>Catch phrase</code>: A sentence that will appear when a caught ball gets this special, for example \"It's a shiny countryball\"</li> <li><code>Rarity</code>: Defines the odds of getting that special. This must be between 0 and 1 included. Check this page to understand how rarity works.</li> <li><code>Emoji</code>: The emoji to place next to the ball instance to identify it. This must be a single unicode emoji, Discord emojis cannot be used for technical reasons.</li> <li><code>Background</code>: The new background to apply, this must be precisely 1428x2000 pixels. If the dimensions are off, the card generation will break.</li> <li><code>Start date</code> and <code>End date</code>: Optional date range to keep this event active. Both values are optional. Not setting a start date will make an event active immediately upon reload.</li> </ul>"},{"location":"selfhosting/admin-panel/getting-started/#advanced_1","title":"Advanced","text":"<ul> <li><code>Tradeable</code>: Similar to the Ball setting, unticking this renders all balls with this special untradeable.</li> <li><code>Hidden</code>: If ticked, this special won't appear in user-facing commands (such as slash command autocompletion)</li> </ul> <p>Don't forget to run <code>b.reloadcache</code> to refresh your modifications!</p> <p>Creating balls and specials are the most important aspect of the admin panel, once you understood this you should be good to go.</p> <p>There are many more tools this admin panel offers, but you should be able to understand by yourself how they work by exploring!</p> <p>Important</p> <p>If you want to expose your admin panel online, please follow this tutorial! It's important that you do not expose the website yourself, the default configuration is insecure.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/","title":"Installing Ballsdex without Docker","text":"<p>The recommended way to run Ballsdex is using Docker, but you may have reasons to run it without this dependency.</p> <p>This install method is supported but only recommended for the advanced users, there are a lot of additional steps and dependencies to manage yourself.</p> <p>Info</p> <p>Few commands will be given, but online guides are given instead. This is because instructions differ between operating systems, so you have to use what's best for you.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#1-setting-up-the-database","title":"1. Setting up the database","text":"<p>Install PostgreSQL and start it. Create a database by following this guide.</p> <p>You must then have a link to connect to the database in the following format: <code>postgres://username:password@localhost:5432/database_name</code></p> <p>Test that your database is up with the following command: <code>psql -c \"\\l\" postgres://username:password@localhost:5432/database_name</code> Check that your database appears in the list and that your user is the owner.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#2-requirements","title":"2. Requirements","text":""},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#git","title":"git","text":"<p>Git is needed to download and update the source code.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#uv","title":"uv","text":"<p>You will need our package manager <code>uv</code> to install the dependencies, manage Python versions and virtual environments.</p> <p>Follow the instructions here to install uv on your system.</p> <p>Tip</p> <p>Ballsdex requires Python 3.14 at least.</p> <p>If you don't have it installed, <code>uv</code> will install it for you, but you can make the installation lighter by installing Python 3.14 with your system's package manager.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#create-a-discord-bot-account","title":"Create a Discord bot account","text":"<p>You must first setup a Discord bot account. You can follow discord.py's tutorial to create and invite your bot.</p> <p>For now, don't copy your token, but keep the page open.</p> <p>Once this is configured, you also need to enable message content intent. Go to the \"Bot\" tab of your application, scroll down to \"Privileged intents\" and tick \"Message content\".</p> <p>Info</p> <p>You can fill the description of your application, it will appear under the \"About me\" section.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#3-download-the-source-code","title":"3. Download the source code","text":"<p>Type the following command to download the latest version of the bot:</p> <pre><code>git clone https://github.com/laggron42/BallsDex-DiscordBot.git\n</code></pre> <p>Then you can use the command cd to change directory and open the folder you just downloaded:</p> <pre><code>cd BallsDex-DiscordBot\n</code></pre>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#4-installing-the-bot","title":"4. Installing the bot","text":"<ol> <li> <p>Download the bot's dependencies and install them in a virtual environment.</p> <pre><code>uv sync\n</code></pre> <p>Info</p> <p>If you don't have Python 3.14, it will also be downloaded for your virtual environment.</p> </li> <li> <p>Open the virtual environment where your dependencies are</p> Linux/macOSWindows (PowerShell) <pre><code>source .venv/bin/activate\n</code></pre> <pre><code>. .\\.venv\\Scripts\\activate.ps1\n</code></pre> </li> <li> <p>Export the <code>BALLSDEXBOT_DB_URL</code> environment variable with the link to Postgres you tested earlier.</p> Linux/macOSWindows (PowerShell) <pre><code>export BALLSDEXBOT_DB_URL=postgres://username:password@localhost:5432/database_name\n</code></pre> <pre><code>$Env.BALLSDEXBOT_DB_URL = 'postgres://username:password@localhost:5432/database_name'\n</code></pre> </li> <li> <p>Check that the bot loads successfully. This should print the version number and exit.     <pre><code>python3 -m ballsdex --version\n</code></pre></p> </li> <li> <p>Open the <code>admin_panel</code> folder for the next steps     <pre><code>cd admin_panel\n</code></pre></p> </li> <li> <p>Initialize the database     <pre><code>python3 -m django migrate\n</code></pre></p> </li> <li> <p>Start the admin panel to configure the settings     <pre><code>DJANGO_SETTINGS_MODULE=\"admin_panel.settings.dev\" uvicorn admin_panel.asgi:application\n</code></pre></p> </li> </ol>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#5-configure-the-bot","title":"5. Configure the bot","text":"<p>Follow this section from the main tutorial to fill the base settings.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#6-run-the-bot","title":"6. Run the bot","text":"<p>Run <code>python3 -m django startbot</code> to start the bot! To shut it down, type Ctrl+C.</p> <p>Tip</p> <p>There are multiple options available when running the bot, do <code>python3 -m django startbot -h</code> to view them.</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#running-the-admin-panel","title":"Running the admin panel","text":"<ol> <li> <p>Open another shell with the virtualenv and the environment variables exported</p> Linux/macOSWindows (PowerShell) <pre><code>source .venv/bin/activate\nexport BALLSDEXBOT_DB_URL=postgres://username:password@localhost:5432/database_name\nexport DJANGO_SETTINGS_MODULE=\"admin_panel.settings.dev\"\n</code></pre> <pre><code>. .\\.venv\\Scripts\\activate.ps1\n$Env.BALLSDEXBOT_DB_URL = 'postgres://username:password@localhost:5432/database_name'\n$Env.DJANGO_SETTINGS_MODULE = 'admin_panel.settings.dev'\n</code></pre> </li> <li> <p>Start the admin panel     <pre><code>cd admin_panel &amp;&amp; uvicorn admin_panel.asgi:application\n</code></pre></p> </li> <li>Follow this guide afterwards</li> </ol> <p>Warning</p> <p>This tutorial shows you how to run the dev configuration, which serves static files. The default configuration does not handle static files and should be handled by you. Ballsdex includes an nginx file showing you how you may configure static files on your own.</p> <p>If you intend to expose this website online, it's super important that you come up with a solution and don't keep the developer configuration</p>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#summary","title":"Summary","text":"<p>Before running any command, do these:</p> Linux/macOSWindows (PowerShell) <pre><code># open the bot's directory\ncd BallsDex-DiscordBot\n\n# activate the virtual environment\nsource .venv/bin/activate\n\n# open the django directory\ncd admin_panel\n\n# export the database env var\nexport BALLSDEXBOT_DB_URL=postgres://username:password@localhost:5432/database_name\nexport DJANGO_SETTINGS_MODULE=\"admin_panel.settings.dev\"\n</code></pre> <pre><code># open the bot's directory\ncd BallsDex-DiscordBot\n\n# activate the virtual environment\n. .\\.venv\\Scripts\\activate.ps1\n\n# export the database env var\n$Env.BALLSDEXBOT_DB_URL = 'postgres://username:password@localhost:5432/database_name'\n$Env.DJANGO_SETTINGS_MODULE = 'admin_panel.settings.dev'\n</code></pre> <p>Then</p> <ul> <li>Start the bot:   <pre><code>python3 -m django startbot\n</code></pre></li> <li>Start the admin panel:   <pre><code>uvicorn admin_panel.asgi:application\n</code></pre></li> </ul>"},{"location":"selfhosting/installation/installing-ballsdex-no-docker/#updating-the-bot","title":"Updating the bot","text":"<ol> <li>Pull the new files.     <pre><code>git pull\n</code></pre></li> <li>Update dependencies     <pre><code>uv sync\n</code></pre></li> <li>Open the admin panel folder     <pre><code>cd admin_panel\n</code></pre></li> <li>Update the database schemas     <pre><code>python3 -m django migrate\n</code></pre></li> <li>Restart the bot and admin panel</li> </ol>"},{"location":"selfhosting/installation/installing-ballsdex/","title":"Installing ballsdex","text":"<p>Ballsdex is an open source Discord bot for catching countryballs, which you can install yourself and customize!</p> <p>While it can run on all operating systems, it is highly recommended to host Ballsdex on Linux (macOS mostly works the same as well). The recommended distribution we will use through this tutorial is Ubuntu 24.04.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#windows-only-installing-wsl","title":"(Windows only) Installing WSL","text":"<p>Windows can easily run Linux distributions thanks to WSL (Windows Subsystem for Linux). You must be running Windows 10 version 2004 and higher (Build 19041 and higher) or Windows 11.</p> <p>Info</p> <p>You need about 30GB of free space on your main disk. Check now that you have enough space.</p> <p>To install Ubuntu, press Win+X and click \"PowerShell (administrator)\" then run the following command:</p> <pre><code>wsl --install\n</code></pre> <p>This will take a while, and may require a restart of your PC. Once it is installed, search \"Ubuntu\" in Windows to open the Linux shell. You will be asked a password on first start.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#1-install-requirements","title":"1. Install requirements","text":"<p>To run Ballsdex, we need Docker and git.</p> <p>Warning</p> <p>Throughout this tutorial, you will need to type a lot of commands. You need to check each command's output and verify that it doesn't produce any error. If you suspect a command failed and errored, do not keep going and fix the errors first.</p> <ol> <li> <p>Type the following commands in your Linux terminal one by one to proceed.    You will be asked to type the password you have chosen earlier to continue. What your type will be hidden but don't worry, keep typing and press enter, it will work. If your terminal doesn't let you paste text with Ctrl+V, try right clicking instead. <pre><code>sudo apt update\nsudo apt install -y git apt-transport-https ca-certificates curl software-properties-common\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\nsudo apt update\napt-cache policy docker-ce\nsudo apt install -y docker-ce\n</code></pre></p> <p>At this point, you should have Docker running.</p> </li> <li> <p>Verify that Docker is running with <code>sudo systemctl status docker</code>, you should have an output like this:    <pre><code>\u25cf docker.service - Docker Application Container Engine\n     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)\n     Active: active (running) since Fri 2022-04-01 21:30:25 UTC; 22s ago\nTriggeredBy: \u25cf docker.socket\n       Docs: https://docs.docker.com\n   Main PID: 7854 (dockerd)\n      Tasks: 7\n     Memory: 38.3M\n        CPU: 340ms\n     CGroup: /system.slice/docker.service\n             \u2514\u25007854 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\n</code></pre>    Press <code>q</code> to exit this screen.</p> </li> <li> <p>Give your user the docker group. This will avoid having to use <code>sudo</code> every time you use Docker.</p> </li> </ol> <p>Warning</p> <p>You do not need to replace ${USER} with your user! The shell will replace it for you.</p> <pre><code>sudo usermod -aG docker ${USER}\nsu - ${USER}\n</code></pre> <ol> <li>Verify Docker is working by running a test    <pre><code>docker run hello-world\n</code></pre>    You should see a welcome message from Docker if everything installed successfully!</li> </ol> <p>Tip</p> <p>If you are running macOS, you can use Docker Desktop instead.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#2-create-a-discord-bot-account","title":"2. Create a Discord bot account","text":"<p>You must first setup a Discord bot account. You can follow discord.py's tutorial to create and invite your bot.</p> <p>For now, don't copy your token, but keep the page open.</p> <p>Once this is configured, you also need to enable message content intent. Go to the \"Bot\" tab of your application, scroll down to \"Privileged intents\" and tick \"Message content\".</p> <p>Info</p> <p>You can fill the description of your application, it will appear under the \"About me\" section.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#3-download-the-bot","title":"3. Download the bot","text":"<p>Type the following command to download the latest version of the bot: <pre><code>git clone https://github.com/laggron42/BallsDex-DiscordBot.git\n</code></pre></p> <p>Then you can use the command <code>cd</code> to change directory and open the folder you just downloaded: <pre><code>cd BallsDex-DiscordBot\n</code></pre></p> <p>From this point, every time you need to type commands for Ballsdex, you must always open the bot's directory first.</p> <p>Navigating files</p> <p>If you want to explore the files and folders with a graphical interface, you can use the following commands to bring up your system's explorer:</p> <ul> <li>Windows (WSL): <code>explorer.exe .</code></li> <li>macOS: <code>open .</code></li> <li>Linux: <code>xdg-open .</code></li> </ul> <p>It will be useful later when we'll need to edit files. Do not forget the trailing dot of each command, otherwise it won't open the correct directory.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#4-installing-the-bot","title":"4. Installing the bot","text":"<ol> <li>Run <code>docker compose build</code>. This will also take some time, wait for the build to complete.</li> <li> <p>Run <code>docker compose run --rm admin-panel python3 -m django createsuperuser</code> to create an admin user    for the admin panel. The email does not actually matter.</p> <p>Note</p> <p>Your password will not show while typing, that's normal, just press enter when you're done.</p> </li> <li> <p>Run <code>docker compose up -d proxy</code> to boot up the admin panel</p> </li> </ol>"},{"location":"selfhosting/installation/installing-ballsdex/#5-configure-the-bot","title":"5. Configure the bot","text":"<p>Open http://localhost:8000 in your browser, this will take you to the admin panel login page. Login using the credentials you have set before.</p> <p>Tip</p> <p>If you forgot your credentials, run <code>docker compose run --rm admin-panel python3 -m django changepassword &lt;username&gt;</code></p> <ol> <li> <p>Go back to the Discord developer portal and click \"Reset Token\" to obtain a new one.    Copy and paste it in the \"Discord token\" section.</p> <p>Danger</p> <p>Do not share your token! It is the password of your bot, and allows anyone full access to its account if shared. Be sure to keep it secure, and immediately reset if you think it leaked.</p> </li> <li> <p>You can change \"Collectible name\" which will replace the word \"countryball\" in the bot. For instance if you set \"rock\", the bot will say \"A wild rock spawned!\" </p> </li> <li> <p>\"Bot name\" is used in various places like <code>/about</code> or <code>/balls completion</code>.</p> </li> <li> <p>The \"/about\" section defines a few traits of the <code>/about</code> command. Feel free to change the description and set a Discord invite.    You must also write your terms of service and a privacy policy and place the link to them (can be a Google Docs).</p> </li> </ol> <p>Now we should be ready for the next part.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#6-run-the-bot","title":"6. Run the bot","text":"<p>To start the bot, simply run <code>docker compose up</code>. This will both start the bot and the admin panel, while showing you the live logs. Wait until the line \"Ballsdex bot is now ready\" shows up, and the bot should be online!</p> <p>To shut down the bot, use Ctrl+C.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#detached-mode","title":"Detached mode","text":"<p>You will notice that the command above blocks your terminal. You can also run the bot in detached mode with <code>docker compose up -d</code> which allows you to keep using the terminal afterwards.</p> <p>In this mode, you can use <code>docker compose logs -f</code> to view the live logs (Ctrl+C to exit). You can also specify containers to filter which logs you want to see, like <code>docker compose logs -f bot</code> or <code>docker compose logs -f admin-panel</code>.</p> <p>To shut down the bot in this mode, run <code>docker compose down</code>.</p>"},{"location":"selfhosting/installation/installing-ballsdex/#7-updating-the-bot","title":"7. Updating the bot","text":"<ol> <li>Run <code>git pull</code> and wait for the changes to be pulled.</li> <li>If you encounter an error, which may happen when you're editing the source files, run <code>git reset --hard HEAD</code> to reset all changes done, then run <code>git pull</code> again. Note that it will reset any changes you may have.</li> <li>Fully shut down the bot with <code>docker compose down</code> (even if you used Ctrl+C before!)</li> <li>Rebuild the bot with <code>docker compose build</code></li> <li>Start again with <code>docker compose up</code> (or <code>docker compose up -d</code> in detached)</li> <li>Verify that no error happens while the bot starts!</li> </ol> <p>Even if your bot is online, there are no countryballs yet, they need to be added through the administration panel, your tool to control the bot's content.</p> <p>The next step of this tutorial is here</p>"},{"location":"selfhosting/misc/admin-commands/","title":"Admin commands","text":"<p>Ballsdex comes with commands to help moderators and administrators manage the bot.</p>"},{"location":"selfhosting/misc/admin-commands/#using-admin-commands","title":"Using admin commands","text":"<p>These commands are hybrid, meaning they can both be used as a slash command (<code>/admin</code>) in a selection of servers, and as a text command (<code>b.admin</code>) that can be used anywhere.</p> <p>Note</p> <p>You can change the <code>b.</code> prefix in your global bot settings.</p> <p>You're also able to mention the bot to replace the prefix, which is useful if you have message content intent turned off: <code>@YourBot ping</code></p> <p>By default, only bot owners have access to the admin commands.</p>"},{"location":"selfhosting/misc/admin-commands/#slash-commands","title":"Slash commands","text":"<p>To synchronize admin slash commands, use <code>b.admin syncslash</code> in the server of your choice. Refresh your Discord client and commands should appear for administrators only by default.</p> <p>Info</p> <p>To grant access to <code>/admin</code> to more roles, head to Server Settings -&gt; Integrations -&gt;  -&gt; <code>/admin</code> and edit the permissions there. <p>You can then type <code>/admin</code> and see the list of commands unrolling.</p>"},{"location":"selfhosting/misc/admin-commands/#text-commands","title":"Text commands","text":"<p>If you can't use slash commands, for example if you're in a server other than your own and want to spawn countryballs, you can use regular text commands.</p> <p>With regular text commands, you can use the <code>b.help</code> command to show the available commands.</p> <ul> <li><code>b.help</code> will show all commands available to you</li> <li><code>b.help admin</code> will list all subcommands from admin</li> <li><code>b.help admin history</code> will show all subcommands of this subcommand </li> <li><code>b.help admin history user</code> will show the full description of this command, with arguments</li> </ul> <p>Let's have a look at this command. It has required arguments and optional arguments shown as \"flags\". They follow a syntax similar to Discord slash commands, with the key and value separated by a colon.</p> <p>To execute that command on yourself, you'd do <code>b.admin history user @Yourself</code>. If you want to filter the trade history with a second user, do <code>b.admin history user @Yourself user2:@Someone</code>.</p> <p>Another example, if you want to spawn a shiny countryball, use <code>b.admin balls spawn special:Shiny</code>. If you have to use arguments that would normally require an autocomplete converter (like specials or countryballs), use the full name instead. If there are spaces in your name, just leave them: <code>b.admin balls spawn countryball:Russian Empire atk_bonus:20</code></p> <p>Info</p> <p><code>b.admin balls</code> will change to your configured slash command name. The flag <code>countryball:</code> will also change to your collectible name.</p>"},{"location":"selfhosting/misc/admin-commands/#admin-commands-permissions","title":"Admin commands permissions","text":"<p>As the bot owner, you will always have full access to your bot. If you choose to move your application to a Discord developer team, then all members of the team will share the same access.</p> <p>Beyond that, permissions are handled with Django. You can create users on your admin panel and share them a specific set of permissions, which will then grant them access to some commands.</p>"},{"location":"selfhosting/misc/admin-commands/#creating-a-django-user","title":"Creating a Django user","text":"<p>The process is slightly different whether you have enabled \"Login with Discord\" (OAuth2) or if you're using password-based authentication.</p> With OAuth2 enabledWith password authentication <p>Ask the user to authenticate to the admin panel. They will be denied at first, but the user will be created.</p> <p>Warning</p> <p>They will later have access to the admin panel, but only with the permissions you've chosen.</p> <ol> <li>Open your admin panel and go to the users tab, then add a new user</li> <li>Write the username and Discord user ID of your admin</li> <li>Disable password-based authentication, unless you want to share them access later</li> </ol> <p>Now you want to tick the \"Is staff\" checkbox of your user to grant them initial access to the admin panel and the admin commands.</p> <p>Warning</p> <p>If you want to remove an admin, do not delete the user object, instead untick the \"Active\" box. This will disable their account while preserving history.</p>"},{"location":"selfhosting/misc/admin-commands/#granting-permissions","title":"Granting permissions","text":"<p>Now you can edit your user and grant them individual permissions.</p> <p>Each model of the bot has a set of 4 permissions: view, add, change, delete. These permissions will be reflected on the admin panel and in the admin commands.</p> <p>For example, to grant the permission to view the rarity list, you need \"Can view countryball\". Spawning a countryball requires \"Can add countryball instance\". Viewing trades requires both \"Can view trade\" and \"Can view trade object\".</p> <p>To make things easier, you can also use permission groups. Give a set of permissions to a group object, then grant these groups to users. For your convenience, two groups are pre-created: \"Administrator\" and \"Staff\".</p> <p>Tip</p> <p>If you were using Ballsdex v2, these groups will mostly reflect the permissions granted by <code>root-role-ids</code> and <code>admin-role-ids</code> respectively.</p> Default groups and permissions <p> Permission Staff Admin Ball View \u274c \u2705 Change \u274c \u2705 Add \u274c \u2705 Delete \u274c \u2705 Regime View \u274c \u2705 Change \u274c \u2705 Add \u274c \u2705 Delete \u274c \u2705 Economy View \u274c \u2705 Change \u274c \u2705 Add \u274c \u2705 Delete \u274c \u2705 Special View \u274c \u2705 Change \u274c \u2705 Add \u274c \u2705 Delete \u274c \u2705 BallInstance View \u2705 \u2705 Change \u274c \u2705 Add \u274c \u2705 Delete \u274c \u2705 BlacklistedID View \u2705 \u2705 Change \u2705 \u2705 Add \u2705 \u2705 Delete \u2705 \u2705 BlacklistedGuild View \u2705 \u2705 Change \u2705 \u2705 Add \u2705 \u2705 Delete \u2705 \u2705 BlacklistHistory View \u2705 \u2705 Change \u274c \u274c Add \u274c \u274c Delete \u274c \u274c Block View \u2705 \u2705 Change \u2705 \u2705 Add \u2705 \u2705 Delete \u2705 \u2705 Friendship View \u2705 \u2705 Change \u2705 \u2705 Add \u2705 \u2705 Delete \u2705 \u2705 GuildConfig View \u2705 \u2705 Change \u2705 \u2705 Add \u274c \u2705 Delete \u274c \u2705 Player View \u2705 \u2705 Change \u2705 \u2705 Add \u274c \u2705 Delete \u274c \u2705 Trade View \u2705 \u2705 Change \u274c \u274c Add \u274c \u274c Delete \u274c \u274c TradeObject View \u2705 \u2705 Change \u274c \u274c Add \u274c \u274c Delete \u274c \u274c </p> <p>You are free to edit those permissions after they were created.</p>"},{"location":"selfhosting/misc/backup-and-transfers/","title":"Backup and transfers","text":"<p>There are 3 places where data unique to your bot is stored:</p> <ul> <li><code>admin_panel/media</code> contains all the assets you have uploaded through the admin panel</li> <li>All data is stored in a PostgreSQL database</li> <li>Automatic backups of the database are available in <code>pgbackups</code></li> </ul>"},{"location":"selfhosting/misc/backup-and-transfers/#manual-backupstransfers","title":"Manual backups/transfers","text":"<p>This is if you want to proceed to a complete backup of everything, or transfer your bot to a different machine.</p> <p>First, make sure your bot is fully turned off. Do <code>docker compose down</code> if you're running Docker.</p> <ul> <li>Same for <code>admin_panel/media</code>, you can create a zip archive with all its contents</li> <li>You can also transfer <code>pgbackups</code> if you wish to preserve backups too.</li> </ul> <p>Then you must make a dump of the database.</p>"},{"location":"selfhosting/misc/backup-and-transfers/#creating-a-database-dump","title":"Creating a database dump","text":"With DockerWithout Docker <pre><code>docker compose up -d postgres-db --wait &amp;&amp; \\\n    docker compose exec postgres-db pg_dump -U ballsdex ballsdex -f data-dump.sql &amp;&amp; \\\n    docker compose cp postgres-db:data-dump.sql .\n</code></pre> <pre><code>pg_dump -U ballsdex ballsdex -f data-dump.sql\n</code></pre> <p>This will generate a file <code>data-dump.sql</code> which you need to preserve, containing all the data.</p>"},{"location":"selfhosting/misc/backup-and-transfers/#importing-a-database-dump","title":"Importing a database dump","text":"With DockerWithout Docker <pre><code>docker compose up -d postgres-db --wait &amp;&amp; \\\n    cat data-dump.sql | \\\n    docker compose exec -T postgres-db psql -U ballsdex ballsdex\n</code></pre> <pre><code>psql -U ballsdex ballsdex -f data-dump.sql\n</code></pre> <p>This will print a lot of lines such as <code>INSERT</code> or <code>ALTER TABLE</code>. Check the logs to ensure no errors were produced.</p> <p>Warning</p> <p>This only works if the database is completely empty!</p> <p>If you messed up and wish to reset the database to redo the import, follow this.</p>"},{"location":"selfhosting/misc/backup-and-transfers/#restoring-a-backup","title":"Restoring a backup","text":"<p>If you accidentally deleted something important, or your database became corrupted, you can restore a backup. They are located in the <code>pgbackups</code> folder.</p> <p>First, you must wipe the database. Then, locate the backup file you want to use (we will assume it's named <code>ballsdex-latest.sql.gz</code> and follow the instructions according to your OS.</p>"},{"location":"selfhosting/misc/backup-and-transfers/#macoslinux","title":"macOS/Linux","text":"With DockerWithout Docker <pre><code>docker compose up -d postgres-db &amp;&amp; \\\n    zcat ballsdex-latest.sql.gz | \\\n    docker compose exec -T postgres-db psql -U ballsdex ballsdex\n</code></pre> <pre><code>zcat ballsdex-latest.sql.gz | psql -U ballsdex ballsdex\n</code></pre>"},{"location":"selfhosting/misc/backup-and-transfers/#windows","title":"Windows","text":"<p>Open the <code>ballsdex-latest.sql.gz</code> using 7zip and extract the resulting <code>.sql</code> file. Move it to your bot's folder, then:</p> With DockerWithout Docker <pre><code>docker compose up -d postgres-db &amp;&amp; \\\n    cat data-dump.sql | \\\n    docker compose exec -T postgres-db psql -U ballsdex ballsdex\n</code></pre> <pre><code>psql -U ballsdex ballsdex -f data-dump.sql\n</code></pre>"},{"location":"selfhosting/misc/backup-and-transfers/#wiping-the-database","title":"Wiping the database","text":"<p>If you need to reset the PostgreSQL database (importing data, restoring a backup), do this:</p> With DockerWithout Docker <pre><code>docker compose down --volumes\n</code></pre> <pre><code>psql -U ballsdex ballsdex -c \"DROP SCHEMA public CASCADE; CREATE SCHEMA public;\"\n</code></pre> <p>Danger</p> <p>This is irreversible, be extra sure that your backups are there!</p>"},{"location":"selfhosting/misc/migrating-windows-wsl/","title":"Migrating to WSL (Windows)","text":"<p>As Docker for Windows has a LOT of errors that are hardly fixable, it is now discouraged to host Ballsdex on Windows. The recommended way is to host on Linux, which is possible on Windows with WSL.</p> <p>This guide will show how to migrate your bot to WSL and ditch Docker for Windows.</p>"},{"location":"selfhosting/misc/migrating-windows-wsl/#1-backup-and-uninstall","title":"1. Backup and uninstall","text":"<p>Follow this guide to backup your data. In theory, you only need the <code>data-dump.sql</code> file, but better be safe.</p> <p>Once this step is complete and you have verified the contents of your database dump, uninstall Docker Desktop from Windows. You must still keep the bot's folder.</p> <p>Tip</p> <p>WSL can use more disk space. If you have less than 30GB available, it is a good idea to clean your computer now.</p>"},{"location":"selfhosting/misc/migrating-windows-wsl/#2-configure-wsl","title":"2. Configure WSL","text":"<p>Follow the first part of the new tutorial to install WSL and Docker. Don't forget the last step to test and confirm that your new Docker works.</p>"},{"location":"selfhosting/misc/migrating-windows-wsl/#3-locate-the-bots-folder","title":"3. Locate the bot's folder","text":"<p>You don't need to clone the bot again, WSL is able to access your Windows files.</p> <p>Open your BallsDex-DiscordBot folder in the file explorer, then in the explorer bar (top left), click and write <code>wsl</code> (instead of <code>cmd</code> or <code>powershell</code> this time). This will open a terminal inside WSL, where your files are accessible.</p> <p>Every time you need to type shell commands for the bot, you need to do the step above.</p>"},{"location":"selfhosting/misc/migrating-windows-wsl/#4-import-your-database-dump","title":"4. Import your database dump","text":"<p>Warning</p> <p>Do NOT start the bot yet! It will mess everything up by re-creating an empty database</p> <ol> <li>Type <code>docker compose up -d postgres-db</code> to only start the database and nothing else.</li> <li>Run <code>cat data-dump.sql | docker compose exec -T psql -U ballsdex ballsdex</code></li> <li>This will print a lot of lines such as <code>INSERT</code> or <code>ALTER TABLE</code>. Check the logs to ensure no errors were produced before continuing.</li> </ol>"},{"location":"selfhosting/misc/migrating-windows-wsl/#5-build-and-start-the-bot","title":"5. Build and start the bot","text":"<p>Run <code>docker compose build</code> to build the image.</p> <p>Then follow this section to start your bot. You shouldn't need any configuration, the bot will pick up your old files and resume just like before.</p>"},{"location":"selfhosting/misc/migrating-windows-wsl/#6-using-docker-on-linux","title":"6. Using Docker on Linux","text":"<p>There is no more Docker Destkop to view your containers, everything goes through the command line, so have the following reminder:</p> <ul> <li>Start your bot: <code>docker compose up -d</code></li> <li>Stop your bot: <code>docker compose down</code></li> <li>Check if your bot is running: <code>docker compose ps</code> (look for a line that says <code>ballsdex-discordbot-bot-1</code>)</li> <li>View logs: <code>docker compose logs</code></li> <li>View logs from the bot only: <code>docker compose logs bot</code></li> <li>View logs from the admin panel: <code>docker compose logs admin-panel</code></li> <li>View live logs from the bot: <code>docker compose logs bot -f</code> (press Ctrl+C to exit)</li> <li>Quick restart the bot: <code>docker compose restart bot</code> (useful after changing config, do not do this after updates)</li> </ul>"},{"location":"selfhosting/misc/rarity-mechanism/","title":"How rarity works","text":"<p>Rarity works differently for ball spawning and specials, but in general a higher number means more likely to happen, and 0 means disabled. Negative numbers are undefined behavior.</p>"},{"location":"selfhosting/misc/rarity-mechanism/#countryball-spawning-rarity","title":"Countryball spawning rarity","text":"<p>The ball rarity is independent from the spawn algorithm's logic, meaning that a ball will spawn when it has to, even if you only have balls with a rarity of 0.00001. In reality, the rarity depends on the other balls you have in your bot. To better illustrate how this work, look at the different situations:</p>"},{"location":"selfhosting/misc/rarity-mechanism/#with-one-countryball","title":"With one countryball","text":"<p>When you have a single countryball with a rarity higher than 0, then no matter what that rarity is, it will always spawn. </p>"},{"location":"selfhosting/misc/rarity-mechanism/#with-two-countryballs","title":"With two countryballs","text":"<p>Now let's add Germany with a rarity of 0.4: </p> <p>Germany has 2/3 chances of spawning, and France has 1/3 chance of spawning. What's interesting is that you will have the exact same result if you change the numbers proportionally: </p> <p>I doubled the rarity of both countries, yet they still exactly have the same odds of spawning. At this point you're starting to get how this works. The general probability for a countryball is this: $$ P = \\dfrac{\\text{ball rarity}}{\\sum\\text{rarities}} $$</p>"},{"location":"selfhosting/misc/rarity-mechanism/#with-more-countryballs","title":"With more countryballs","text":"<p>Finally, let's add Italy with a rarity of 0.2: </p> <p>Italy now can spawn, but in reality, it decreased Germany and France's probability of spawning to 4/7 and 3/7 respectively, Italy taking that final 1/7.</p>"},{"location":"selfhosting/misc/rarity-mechanism/#special-rarity","title":"Special rarity","text":"<p>Specials are a bit similar to the system above</p> <p>Warning</p> <p>Unlike countryballs that allow any rarity above 0, it is important that specials have a rarity between 0 and 1. Going outside this range will most likely result in strange behavior.</p> <p>Special rarity has changed as of 2.27.0, and is now simpler than it was before.</p> <p>Set each special rarity to the rarity that you want it to have. Eg, if you want a special to have a 20% chance of spawning, set its rarity to 0.2. If you want it to have a 1% chance of spawning, set its rarity to 0.01.</p> <p>If the special rarities sum to 1 or over 1, then commons will not spawn. Also, rarities will be \"squashed\" down to 100%, so if you have a Special A with a rarity set as 2, and Special B set as 3, then Special A will have a 2/5 chance of spawning (40%), Special B will have a 60% chance of spawning (60%), and commons will have a 0% chance of spawning (since the rarities sum to over one)</p>"},{"location":"selfhosting/misc/upgrading-to-3.0/","title":"Upgrading to 3.0","text":"<p>This guide will help you upgrade from 2.X to Ballsdex 3.0.</p> <p>Warning</p> <p>Ballsdex 3.0 brings a lot of breaking changes!</p> <p>If you have modifications or custom packages, you must remove them before upgrading. Once you have upgraded, you can look for the updated version of your packages.</p>"},{"location":"selfhosting/misc/upgrading-to-3.0/#1-pre-requirements-and-disclaimers","title":"1. Pre-requirements and disclaimers","text":"<ul> <li>There must be no custom package. Remove any custom package you may have, and only after the bot   migration you may look into migrating them.</li> <li>If you are relying on eval to run your bot, be aware that they will most likely break and   need to be rewritten.</li> <li>The output of <code>git status</code> must show no modified or untracked files!<ul> <li>If you have files listed there, copy the modifications and run <code>git reset --hard HEAD</code></li> </ul> </li> <li>You must be running on the latest 2.X version<ul> <li>Run a normal update and restart your bot once to ensure you're up-to-date.</li> </ul> </li> <li> <p>For Docker users, you must have Docker Compose version 2.39.4 at least.   Run <code>docker compose version</code> to check, and upgrade if necessary.</p> <p>If you followed the initial install instructions on Ubuntu, <code>sudo apt update &amp;&amp; sudo apt upgrade</code> should be enough.</p> </li> <li> <p>If you're running nginx locally, ditch your configuration. It's now included in Docker.</p> </li> <li>If you have a list of admins on the admin panel that you wish to preserve, be prepared to back   them up. The admins will be wiped and won't be recovered during the migration.</li> <li> <p>Turn off your bot now</p> With DockerWithout Docker <pre><code>docker compose down\n</code></pre> <p>Just do Ctrl+C on both your bot and the admin panel</p> </li> </ul>"},{"location":"selfhosting/misc/upgrading-to-3.0/#2-perform-a-backup","title":"2. Perform a backup","text":"<p>This is the most important step! The database will be wiped later.</p> With DockerWithout Docker <pre><code>docker compose up -d postgres-db --wait &amp;&amp; \\\n    docker compose exec postgres-db pg_dump -U ballsdex ballsdex -f data-dump.sql &amp;&amp; \\\n    docker compose cp postgres-db:data-dump.sql pre-migration-data-dump.sql\n</code></pre> <pre><code>pg_dump -U ballsdex ballsdex -f pre-migration-data-dump.sql\n</code></pre> <p>Triple-check that there is a <code>pre-migration-data-dump.sql</code> file and that it's not empty! You may also want to copy it to different locations just to be sure.</p>"},{"location":"selfhosting/misc/upgrading-to-3.0/#3-prepare-your-data-for-the-migration","title":"3. Prepare your data for the migration","text":"<p>For the migration to work successfully, we need to drop multiple tables related to Django authentication.</p> <p>Warning</p> <p>Past this point, you will lose all of your administrators configured on the admin panel.</p> <p>It most likely matters little for 95% of you, the admins can be re-created later in a few seconds. However, if you have spent a long time adding a lot of admins with custom permissions, you may want to write down those information.</p> <p>Run the following commands to wipe a selection of tables, then create a new backup.</p> With DockerWithout Docker <pre><code>docker compose up -d postgres-db --wait &amp;&amp; \\\n    docker compose run --rm migration python3 manage.py migrate admin zero &amp;&amp; \\\n    docker compose run --rm migration python3 manage.py migrate auth zero &amp;&amp; \\\n    docker compose run --rm migration python3 manage.py migrate contenttypes zero &amp;&amp; \\\n    docker compose run --rm migration python3 manage.py migrate sessions zero &amp;&amp; \\\n    docker compose exec postgres-db pg_dump -U ballsdex ballsdex -f data-dump.sql &amp;&amp; \\\n    docker compose cp postgres-db:data-dump.sql final-data-dump.sql\n</code></pre> <pre><code># activate your venv and export BALLSDEXBOT_DB_URL\ncd admin_panel\npython3 manage.py migrate admin zero\npython3 manage.py migrate auth zero\npython3 manage.py migrate contenttypes zero\npython3 manage.py migrate sessions zero\n\npg_dump -U ballsdex ballsdex -f final-data-dump.sql\n</code></pre> <p>You now have two files: <code>pre-migration-data-dump.sql</code> and <code>final-data-dump.sql</code> - <code>pre-migration</code> must be used if you wish to roll back to 2.X, it's an unmodified backup - <code>final</code> must be used for the following steps. Do not use it to roll back to 2.X, it won't work!</p>"},{"location":"selfhosting/misc/upgrading-to-3.0/#wipe-the-database","title":"Wipe the database","text":"<p>This only applies to Docker users.</p> <p>3.0 upgrades the database to Postgres 18. A major upgrade of Postgres implies a deletion of the database, which will be imported later from your backup.</p> <p>Warning</p> <p>Are you 100% sure you have backed everything up? Check again now that <code>pre-migration-data-dump.sql</code> exists.</p> <p>Run the following command to delete your database.</p> <pre><code>docker compose down --volumes\n</code></pre>"},{"location":"selfhosting/misc/upgrading-to-3.0/#4-perform-the-upgrade","title":"4. Perform the upgrade","text":"With DockerWithout Docker <ol> <li>Switch to the new branch     <pre><code>git switch v3\ngit pull\n</code></pre></li> <li>Create the new database     <pre><code>docker compose up -d postgres-db --wait\n</code></pre></li> <li>Import your database dump     <pre><code>cat final-data-dump.sql | docker compose exec -T postgres-db psql -U ballsdex ballsdex\n</code></pre></li> <li>Rebuild the bot     <pre><code>docker compose build\n</code></pre></li> <li>Run migrations     <pre><code>docker compose up migration\n</code></pre></li> </ol> <ol> <li>Install uv     !!! info         You can uninstall Poetry if you want,         it's not needed anymore.</li> <li>Switch to the new branch     <pre><code>git switch v3\ngit pull\n</code></pre></li> <li>Install the new virtual environment     <pre><code>uv sync\n</code></pre>     !!! note         Python 3.14 is required to run Ballsdex 3.0. If it's not installed on your system,         uv will install it for you.</li> <li> <p>Activate the new virtual environment</p> Linux/macOSWindows (PowerShell) <pre><code>source .venv/bin/activate\n</code></pre> <pre><code>. .\\.venv\\Scripts\\activate.ps1\n</code></pre> </li> <li> <p>Export the usual environment vars</p> Linux/macOSWindows (PowerShell) <pre><code>export BALLSDEXBOT_DB_URL=postgres://username:password@localhost:5432/database_name\n</code></pre> <pre><code>$Env.BALLSDEXBOT_DB_URL = 'postgres://username:password@localhost:5432/database_name'\n</code></pre> </li> <li> <p>Run the migrations     <pre><code>cd admin_panel &amp;&amp; python3 -m django migrate\n</code></pre></p> </li> </ol>"},{"location":"selfhosting/misc/upgrading-to-3.0/#5-reconfigure-the-settings","title":"5. Reconfigure the settings","text":"<p>Ballsdex 3.0 does not use <code>config.yml</code> anymore for its configuration, instead it's all on the admin panel. You can still import your old settings.</p> <ol> <li>Create a local admin account.     Remember that all admin accounts were lost in the process, you have to recreate one.</li> <li> <p>Start the admin panel</p> With DockerWithout Docker <pre><code>docker compose up -d proxy\n</code></pre> <p>Note</p> <p>Don't start the admin panel with <code>admin-panel</code> service anymore, use <code>proxy</code> instead.</p> <p>Warning</p> <p>Because this note was misunderstood, you have to use the <code>proxy</code> service only if you want to start the panel.</p> <p>If you are told in the docs to use the <code>admin-panel</code> service, don't replace it with <code>proxy</code> just because of this note, use the command as-is please.</p> <p>After having activated your venv and exported the env vars</p> Linux/macOSWindows (PowerShell) <pre><code>export DJANGO_SETTINGS_MODULE=\"admin_panel.settings.dev\"\ncd admin_panel &amp;&amp; uvicorn admin_panel.asgi:application\n</code></pre> <pre><code>$Env.DJANGO_SETTINGS_MODULE = 'admin_panel.settings.dev'\ncd admin_panel &amp;&amp; uvicorn admin_panel.asgi:application\n</code></pre> <p>Note</p> <p>You are running the admin panel in developer mode as the default configuration does not serve static files anymore. Docker handles it via a pre-configured nginx proxy.</p> <p>You will have to find a solution later to expose the static files yourself.</p> </li> <li> <p>Open the new settings page</p> </li> <li>Tick the checkbox next to \"Global bot settings\"</li> <li>In the \"Action\" drop-down, select \"Import YAML settings\" and click \"Go\"</li> <li>Choose the <code>config.yml</code> file to upload, and continue</li> <li>Verify that all the settings were imported as intended.</li> </ol> <p>Warning</p> <p>This will override settings you have previously configured here.</p> <p>You're all good! You can now start your bot again.</p>"}]}